<?xml version="1.0" encoding="utf-8"?>

<!--
  ASP.NET アプリケーションを構成する方法の詳細については、
  http://go.microsoft.com/fwlink/?LinkId=169433 を参照してください
  -->

<configuration>
  <configSections>
    <!-- フレームワークの設定セクション -->
    <section name="Toyota.eCRB.SystemFrameworks" type="Toyota.eCRB.SystemFrameworks.Configuration.ConfigurationHandler, Toyota.eCRB.SystemFrameworks.Configuration" />
  </configSections>

  <connectionStrings>
    <!--セッション管理用のデータベース接続文字列です。-->
    <add name="OracleAspNetConString" connectionString="DATA SOURCE=ICROP4DB;PERSIST SECURITY INFO=True;USER ID=icropuser;Password=ecrb" />
    <!--アプリで使用するデータベース接続文字列です。-->
    <add name="My.MySettings.ConnectionString" connectionString="DATA SOURCE=ICROP4DB;PASSWORD=ecrb;USER ID=icropuser" providerName="Oracle.DataAccess.Client" />
    <add name="My.MySettings.2ndConnectionString" connectionString="DATA SOURCE=ICROP4DB;PASSWORD=ecrb;USER ID=icropuser" providerName="Oracle.DataAccess.Client" />
  </connectionStrings>

  <system.web>
    <compilation debug="true" strict="false" explicit="true" targetFramework="4.0" />
    <!-- 権限管理 -->
    <authentication mode="Forms">
      <forms loginUrl="~/SC3010101.aspx" protection="All" path="/" cookieless="UseCookies" />
    </authentication>
    <!-- 全てのページのclientIDModeを「Static」にし、要求の検証機能をOFFにします。 -->
    <pages clientIDMode="Static" validateRequest="false">
      <controls>
        <!-- フレームワークで定義されているカスタムコントロールの定義です。 -->
        <add tagPrefix="icrop" namespace="Toyota.eCRB.SystemFrameworks.Web.Controls" assembly="Toyota.eCRB.SystemFrameworks.Web" />
      </controls>
      <namespaces>
        <add namespace="Toyota.eCRB.SystemFrameworks.Web"/>
      </namespaces>
    </pages>
    <!-- セッションの管理をオラクルで行うための設定 -->
    <sessionState mode="Custom" customProvider="MyOracleSessionStateStore" timeout="480">
      <providers>
        <add name="MyOracleSessionStateStore" type="Oracle.Web.SessionState.OracleSessionStateStore, Oracle.Web,Version=4.112.2.0, Culture=neutral, PublicKeyToken=89b483f429c47342" connectionStringName="OracleAspNetConString" />
      </providers>
    </sessionState>
    <!-- カスタムエラーページの設定 -->
    <customErrors mode="On" defaultRedirect="~/Error/SC3010301.aspx">
      <error statusCode="403" redirect="~/Error/SC3010302.aspx" />
    </customErrors>

    <!-- httpModules は、サーバでは不要-->
    <httpModules>
      <add name="PerformanceTraceHttpModule" type="Toyota.eCRB.SystemFrameworks.Web.PerformanceTraceHttpModule, Toyota.eCRB.SystemFrameworks.Web" />
    </httpModules>
    
  </system.web>

  <!--認証が必要なページ又はフォルダを指定します。-->
  <location path="Pages">
    <system.web>
      <authorization>
        <deny users="?" />
      </authorization>
    </system.web>
  </location>

  <!-- REST通信設定 -->
  <location path="Services">
    <system.web>
      <!-- 受信データにHTMLタグ入力を許可 -->
      <httpRuntime requestValidationMode="2.0" />
      <webServices>
        <!-- Postのみを許可し、Soapを拒否 -->
        <protocols>
          <add name="HttpPost"/>
          <remove name="HttpSoap"/>
          <remove name="HttpSoap12"/>
        </protocols>
        <!-- Soapを拒否したことに伴う警告を非表示 -->
        <conformanceWarnings>
          <remove name='BasicProfile1_1'/>
        </conformanceWarnings>
      </webServices>
    </system.web>
  </location>

  <!-- system.webServer は、サーバでは必要-->
  <system.webServer>
    <modules runAllManagedModulesForAllRequests="true" >
      <remove name="PerformanceTraceHttpModule" />
      <add name="PerformanceTraceHttpModule" type="Toyota.eCRB.SystemFrameworks.Web.PerformanceTraceHttpModule, Toyota.eCRB.SystemFrameworks.Web" />
    </modules>
  </system.webServer>

  <system.serviceModel>
    <serviceHostingEnvironment aspNetCompatibilityEnabled="true"></serviceHostingEnvironment>
  </system.serviceModel>

  <Toyota.eCRB.SystemFrameworks>
    <!-- バージョン情報 -->
    <Class Name="VersionInformation">
      <Setting Name="">
        <!-- 
          1.0.0: Sales1A (TCV蓋閉め）
          1.0.1: Sales1A (TCV蓋空け）
          1.1.0: Service1
          1.2.0: Sales1B
          1.3.0: Sales2
          2.0.0: Sales2
          2.0.1: IT7683_【A.STEP1】
          4.0.0: IT9513
          4.1.1: IT9745
          4.1.2: IT9824
         -->
        <Item Name="Version" SerializeAs="System.String" Value="4.1.2" />
      </Setting>
    </Class>

    <!-- DB接続管理 -->
    <Class Name="ConnectionManager">
      <!-- DBリトライ回数に関する設定 -->
      <Setting Name="">
        <!-- 最大リトライ回数 -->
        <Item Name="MaxConnectionOpenRetry" SerializeAs="System.Int32" Value="2" />
        <!-- リトライ間隔(単位：ミリ秒) -->
        <Item Name="ConnectionOpenRetryWaitMSec" SerializeAs="System.Int32" Value="100" />
        <Item Name="SqlCommandTimeout" SerializeAs="System.Int32" Value="300" />
        <Item Name="SlowQuerySeconds" SerializeAs="System.Int32" Value="300" />
      </Setting>
    </Class>

    <!-- 画面ID -->
    <Class Name="ScreenUrl">
      <Setting Name="">
        <Item Name="GK_Login" SerializeAs="System.String" Value="~/SC3090101.aspx" />
        <Item Name="WEB_Login" SerializeAs="System.String" Value="~/SC3010101.aspx" />
        <Item Name="TCV" SerializeAs="System.String" Value="icrop:tcv:openWindow" />
      </Setting>
    </Class>

    <!-- 権限別トップページ -->
    <Class Name="TopPageUrl">
      <!-- iPadトップページ -->
      <Setting Name="iPad">
        <Item Name="9"  SerializeAs="System.String" Value="SC3140103" />
        <Item Name="10" SerializeAs="System.String" Value="SC3220201" />
        <Item Name="14" SerializeAs="System.String" Value="SC3150101" />
        <Item Name="52" SerializeAs="System.String" Value="SC3100401" />
        <Item Name="55" SerializeAs="System.String" Value="SC3200101" />
        <Item Name="58" SerializeAs="System.String" Value="SC3230101" />
        <Item Name="62" SerializeAs="System.String" Value="SC3240101" />
      </Setting>
      <!-- iPodトップページ -->
      <Setting Name="iPod">
        <Item Name="64" SerializeAs="System.String" Value="SC3320101" />
        <Item Name="65" SerializeAs="System.String" Value="SC3340101" />
      </Setting>
      <!-- その他トップページ -->
      <Setting Name="*">
        <Item Name="9"  SerializeAs="System.String" Value="SC3140103" />
        <Item Name="10" SerializeAs="System.String" Value="SC3220201" />
        <Item Name="14" SerializeAs="System.String" Value="SC3150101" />
        <Item Name="52" SerializeAs="System.String" Value="SC3100401" />
        <Item Name="55" SerializeAs="System.String" Value="SC3200101" />
        <Item Name="58" SerializeAs="System.String" Value="SC3230101" />
        <Item Name="62" SerializeAs="System.String" Value="SC3240101" />
        <Item Name="64" SerializeAs="System.String" Value="SC3320101" />
        <Item Name="65" SerializeAs="System.String" Value="SC3340101" />
      </Setting>
    </Class>

    <!-- セールス・サービス判断 -->
    <Class Name="StaffDivision">
      <Setting Name="">
        <Item Name="9" SerializeAs="System.String" Value="Service" />
        <Item Name="10" SerializeAs="System.String" Value="Service" />
        <Item Name="14" SerializeAs="System.String" Value="Service" />
        <Item Name="32" SerializeAs="System.String" Value="Service" />
        <Item Name="52" SerializeAs="System.String" Value="Service" />
        <Item Name="54" SerializeAs="System.String" Value="Service" />
        <Item Name="55" SerializeAs="System.String" Value="Service" />
        <Item Name="58" SerializeAs="System.String" Value="Service" />
        <Item Name="62" SerializeAs="System.String" Value="Service" />
        <Item Name="64" SerializeAs="System.String" Value="Service" />
        <Item Name="65" SerializeAs="System.String" Value="Service" />
      </Setting>
    </Class>

    <!-- 権限別の処理判断 -->
    <Class Name="Individual">
      <Setting Name="">
        <Item Name="14" SerializeAs="System.String" Value="NonSerch" />
        <Item Name="51" SerializeAs="System.String" Value="NonSerch" />
        <Item Name="52" SerializeAs="System.String" Value="NonSerch" />
      </Setting>
    </Class>

    <!-- 履歴管理 -->
    <Class Name="SessionManager">
      <Setting Name="UrlHistory">
        <Item Name="MaxHistoryCount" SerializeAs="System.Int32" Value="10" />
        <Item Name="MaxHistorySizeKB" SerializeAs="System.Int32" Value="10" />
      </Setting>
    </Class>

    <!-- 環境設定 -->
    <Class Name="EnvironmentSetting">
      <Setting Name="">
        <Item Name="CountryCode" SerializeAs="System.String" Value="GZ" />
        <Item Name="GhdAbbreviation" SerializeAs="System.String" Value="GHD" />
        <Item Name="WordLanguageCode" SerializeAs="System.String" Value="en" />
        <Item Name="ReleaseDate" SerializeAs="System.String" Value="201112190950" />
      </Setting>
    </Class>

    <!-- ログ出力設定 -->
    <Class Name="LogManager">
      <Setting Name="">
        <Item Name="EnableErrorLog" SerializeAs="System.String" Value="true" />
        <Item Name="EnableWarnLog" SerializeAs="System.String" Value="true" />
        <Item Name="EnableInfoLog" SerializeAs="System.String" Value="true" />
        <Item Name="EnableTraceLog" SerializeAs="System.String" Value="true" />
        <Item Name="EnableReceiveLog" SerializeAs="System.String" Value="true" />
        <Item Name="EnablePerformLog" SerializeAs="System.String" Value="true" />
        <Item Name="EnablePerformErrorLog" SerializeAs="System.String" Value="true" />
        <Item Name="EnableSecurityLog" SerializeAs="System.String" Value="true" />
      </Setting>
    </Class>

    <!-- バリデーション用正規表現文字列 -->
    <Class Name="Validation">
      <Setting Name="">
        <Item Name="HankakuAlphabetFormat" SerializeAs="System.String" Value="^[a-zA-Z]+$" />
        <Item Name="HankakuEisuFormat" SerializeAs="System.String" Value="^[a-zA-Z0-9]+$" />
        <Item Name="HankakuNumberFormat" SerializeAs="System.String" Value="^[0-9]+$" />
        <Item Name="MailAddressFormat" SerializeAs="System.String" Value="^*" />
        <Item Name="TagFormat" SerializeAs="System.String" Value="&lt;[a-zA-Z!\?\/]"/>
        <Item Name="RegNoFormat" SerializeAs="System.String" Value="^*" />
        <Item Name="VinFormat" SerializeAs="System.String" Value="^*" />
        <Item Name="PhoneNumberFormat" SerializeAs="System.String" Value="^[-0-9]+$" />
        <Item Name="MobilePhoneNumberFormat" SerializeAs="System.String" Value="^[-0-9]+$" />
        <Item Name="PostalCodeFormat" SerializeAs="System.String" Value="^*" />
      </Setting>
      <Setting Name="InvalidCharacters">
        <Item Name="Unicode 6" SerializeAs="System.String" Value="0840-085F,1BC0-1BFF,AB00-AB2F,11000-1107F,16800-16A3F,1B000-1B0FF,1F0A0-1F0FF,1F300-1F5FF,1F600-1F64F,1F680-1F6FF,1F700-1F77F,2B740-2B81F,2728,2733,2734,274C,2754,2755,2764,27A1,27BF,2B05,2B06,2B07,2B55,303D,1F004,1F170,1F171,1F17E,1F17F,1F18E,1F192,1F194,1F195,1F197,1F199,1F19A,1F1E7,1F1E8,1F1E9,1F1EA,1F1EA,1F1EB,1F1EC,1F1EE,1F1EF,1F1F0,1F1F3,1F1F5,1F1F7,1F1F7,1F1F7,1F1F8,1F1F8,1F1F9,1F1FA,1F1FA,1F201,1F202,1F21A,1F22F,1F233,1F235,1F236,1F237,1F238,1F239,1F23A,1F250,3297,3299,20E3,20E3,20E3,20E3,20E3,20E3,20E3,20E3,20E3,20E3,20E3,2122,2196,2197,2198,2199,23E9,23EA,25B6,25C0,2600,2601,260E,2614,2615,261D,263A,2648,2649,264A,264B,264C,264D,264E,264F,2650,2651,2652,2653,2660,2663,2665,2666,2668,267F,26A0,26A1,26BD,26BE,26C4,26CE,26EA,26F2,26F3,26F5,26FA,26FD,2702,2708,270A,270B,270C" />
        <Item Name="Back Quote" SerializeAs="System.String" Value="0021" />
      </Setting>
    </Class>

    <!-- ログイン設定 -->
    <Class Name="LoginManager">
      <Setting Name="UserAgent">
        <Item Name="iPad" SerializeAs="System.String" Value="^Mozilla/5.0 \(iPad" />
        <Item Name="iPhone" SerializeAs="System.String" Value="^Mozilla/5.0 \(iPhone" />
        <Item Name="iPod" SerializeAs="System.String" Value="^Mozilla/5.0 \(iPod" />
        <Item Name="*" SerializeAs="System.String" Value=".*" />
      </Setting>
      <Setting Name="Encrypt">
        <!--暗号化パスワード利用有無-->
        <Item Name="PasswordEncryption" SerializeAs="System.String" Value="False" />
      </Setting>
    </Class>

    <!-- 基盤フック -->
    <Class Name="System">
      <Setting Name="Hooks">
      </Setting>
    </Class>

  </Toyota.eCRB.SystemFrameworks>

<!-- 拡張設定 -->
<system.web.extensions>
  <scripting>
    <webServices>
      <jsonSerialization maxJsonLength="110000"></jsonSerialization>
    </webServices>
  </scripting>
</system.web.extensions>

  <!-- ログ出力 -->
  <system.diagnostics>
    <switches>
      <!-- アプリケーションのログレベルを設定 -->
      <!-- Toyota.eCRB.SystemFrameworks - LogManager で On/Off -->
      <add name="ErrorLog" value="Error"/>
      <add name="WarnLog" value="Warning"/>
      <add name="InfoLog" value="Information"/>
      <add name="TraceLog" value="All"/>
      <add name="ReceiveLog" value="Information"/>
      <add name="SecurityLog" value="All"/>
      <add name="PerformLog" value="Information"/>
      <add name="PerformErrorLog" value="Error"/>
    </switches>

    <sources>
      <source name="ErrorLog">
        <listeners>
          <add name="ErrorLogListener"/>
          <add name="EventLog"/>
        </listeners>
      </source>
      <source name="WarnLog">
        <listeners>
          <add name="WarnLogListener"/>
        </listeners>
      </source>
      <source name="InfoLog">
        <listeners>
          <add name="InfoLogListener"/>
        </listeners>
      </source>
      <source name="TraceLog">
        <listeners>
          <add name="TraceLogListener"/>
        </listeners>
      </source>
      <source name="ReceiveLog">
        <listeners>
          <add name="ReceiveLogListener"/>
        </listeners>
      </source>
      <source name="SecurityLog">
        <listeners>
          <add name="SecurityLogListener"/>
        </listeners>
      </source>
      <source name="PerformLog">
        <listeners>
          <add name="PerformLogListener"/>
        </listeners>
      </source>
      <source name="PerformErrorLog">
        <listeners>
          <add name="PerformErrorLogListener"/>
          <add name="PerformErrorEventLog"/>
        </listeners>
      </source>
    </sources>

    <!-- ログ出力先の追加 -->
    <sharedListeners>
      <!-- ErrorLog -->
      <add name="ErrorLogListener" type="Toyota.eCRB.SystemFrameworks.Core.TraceLogListener,Toyota.eCRB.SystemFrameworks.Core" BaseFilename="D:\LogFiles\Applog_i-CROP_Service_TH2\error.log" Delimiter=" " Encoding="UTF-8" OutputHeaders="DateTime,EventType" LogDateTimeFormat="yyyy/MM/dd_HH:mm:ss.fff" MaxFileSize="0" />
      <add name="EventLog" type="System.Diagnostics.EventLogTraceListener" initializeData="iCROP.Web"/>

      <!-- WarnLog -->
      <add name="WarnLogListener" type="Toyota.eCRB.SystemFrameworks.Core.TraceLogListener,Toyota.eCRB.SystemFrameworks.Core" BaseFilename="D:\LogFiles\Applog_i-CROP_Service_TH2\warn.log" Delimiter=" " Encoding="UTF-8" OutputHeaders="DateTime,EventType" LogDateTimeFormat="yyyy/MM/dd_HH:mm:ss.fff" MaxFileSize="0" />

      <!-- InfoLog -->
      <add name="InfoLogListener" type="Toyota.eCRB.SystemFrameworks.Core.TraceLogListener,Toyota.eCRB.SystemFrameworks.Core" BaseFilename="D:\LogFiles\Applog_i-CROP_Service_TH2\info.log" Delimiter=" " Encoding="UTF-8" OutputHeaders="DateTime,EventType" LogDateTimeFormat="yyyy/MM/dd_HH:mm:ss.fff" MaxFileSize="0" />

      <!-- TraceLog -->
      <add name="TraceLogListener" type="Toyota.eCRB.SystemFrameworks.Core.TraceLogListener,Toyota.eCRB.SystemFrameworks.Core" BaseFilename="D:\LogFiles\Applog_i-CROP_Service_TH2\trace.log" Delimiter=" " Encoding="UTF-8" OutputHeaders="DateTime,EventType" LogDateTimeFormat="yyyy/MM/dd_HH:mm:ss.fff" MaxFileSize="3000000" />

      <!-- ReceiveLog -->
      <add name="ReceiveLogListener" type="Toyota.eCRB.SystemFrameworks.Core.TraceLogListener,Toyota.eCRB.SystemFrameworks.Core" BaseFilename="D:\LogFiles\Applog_i-CROP_Service_TH2\webservice_error.log" Delimiter=" " Encoding="UTF-8" OutputHeaders="DateTime,EventType" LogDateTimeFormat="yyyy/MMdd_HH:mm:ss.fff" MaxFileSize="0" />

      <!-- SecurityLog -->
      <add name="SecurityLogListener" type="Toyota.eCRB.SystemFrameworks.Core.TraceLogListener,Toyota.eCRB.SystemFrameworks.Core" BaseFilename="D:\LogFiles\Applog_i-CROP_Service_TH2\security.log" Delimiter=" " Encoding="UTF-8" OutputHeaders="DateTime,EventType" LogDateTimeFormat="yyyy/MM/dd_HH:mm:ss.fff" MaxFileSize="0" />

      <!-- PerformLog -->
      <add name="PerformLogListener" type="Toyota.eCRB.SystemFrameworks.Core.TraceLogListener,Toyota.eCRB.SystemFrameworks.Core" BaseFilename="D:\LogFiles\Applog_i-CROP_Service_TH2\performance.log" Delimiter=" " Encoding="UTF-8" OutputHeaders="DateTime,EventType" LogDateTimeFormat="yyyy/MM/dd_HH:mm:ss.fff" MaxFileSize="0" />

      <!-- PerformErrorLog -->
      <add name="PerformErrorLogListener" type="Toyota.eCRB.SystemFrameworks.Core.TraceLogListener,Toyota.eCRB.SystemFrameworks.Core" BaseFilename="D:\LogFiles\Applog_i-CROP_Service_TH2\performance_error.log" Delimiter=" " Encoding="UTF-8" OutputHeaders="DateTime,EventType" LogDateTimeFormat="yyyy/MM/dd_HH:mm:ss.fff" MaxFileSize="0" />
      <add name="PerformErrorEventLog" type="System.Diagnostics.EventLogTraceListener" initializeData="iCROP.Web"/>

    </sharedListeners>
  </system.diagnostics>

  <appSettings>
    <!-- Pushサーバー(GTMC環境) -->
    <add key="PushServerAddress" value="http://192.168.2.13:4567/cmd/"/>
    <!-- 基幹顧客コード置換タイプ「0：販売店コード追加」「1：販売店コード追加しない」 -->
    <add key="DMSCustomerCodeFlg" value="0"/>


    <!-- 設定値データキャッシュ経過秒-->
    <add key="SettingValueExpiration" value="600" />

    <!-- サーバの処理時間が閾値を超えた場合にログ出力 閾値:ミリ秒 -->
    <add key="PerformErrorThreshold" value="5000" />

  </appSettings>


</configuration>
