function CreateChips(){gSelectedChipId="";gMovingChipObj=null;if(!gArrObjChip)gArrObjChip=new Array;var jsonData=$("#hidJsonData").val();$("#hidJsonData").attr("value","");var chipDataList=$.parseJSON(jsonData);var arrDuplicateChipsId=new Array;var strPreJobDtlId="";for(var strKey in chipDataList){var chipData=chipDataList[strKey];var objChip=new ReserveChip(strKey);objChip.setChipParameter(chipData);if(objChip.stallUseStatus==C_STALLUSE_STATUS_NOSHOW)continue;if(objChip.tempFlg==C_TEMP_FLG_ON)continue;
if(objChip.displayStartDate>=gEndWorkTime||objChip.displayEndDate<=gStartWorkTime)continue;if($("#stallId_"+objChip.stallId).length==0)continue;strKey=chipData.STALL_USE_ID;if(gArrObjChip[strKey]==undefined){gArrObjChip[strKey]=objChip;gArrObjChip[strKey].createChip(C_CHIPTYPE_STALL_FASTER);FasterSetChipPosition(gArrObjChip[strKey]);BindChipClickEvent(strKey)}else{gArrObjChip[strKey]=objChip;gArrObjChip[strKey].updateStallChip();SetChipPosition(strKey,"","","")}if(IsDefaultDate(gArrObjChip[strKey].rsltStartDateTime)==
false&&IsDefaultDate(gArrObjChip[strKey].rsltEndDateTime)||IsDefaultDate(gArrObjChip[strKey].rsltEndDateTime)==false)arrDuplicateChipsId.push(strKey)}var nFirstLoop=true;var strPreJobId="";var strPreStallUseId="";for(var strKey in chipDataList){if(nFirstLoop){nFirstLoop=false;strPreJobId=chipDataList[strKey].JOB_DTL_ID;strPreStallUseId=chipDataList[strKey].STALL_USE_ID;continue}if(chipDataList[strKey].JOB_DTL_ID==strPreJobId){if(gArrObjChip[chipDataList[strKey].STALL_USE_ID])gArrObjChip[chipDataList[strKey].STALL_USE_ID].stopFlg=
true;if(gArrObjChip[strPreStallUseId])gArrObjChip[strPreStallUseId].stopFlg=true}strPreJobId=chipDataList[strKey].JOB_DTL_ID;strPreStallUseId=chipDataList[strKey].STALL_USE_ID}for(var strChipId in arrDuplicateChipsId){if(CheckgArrObjChip(arrDuplicateChipsId[strChipId])==false)continue;CreateWhiteBorders(arrDuplicateChipsId[strChipId])}if($("#hidSelectedChipId").val()!=""){jsonData=$("#hidSelectedChipId").val();$("#hidSelectedChipId").val("");var chipData=$.parseJSON(jsonData);if(gArrObjChip[chipData.STALL_USE_ID]&&
!chipData.KEY){ScrollToShowChip(chipData.STALL_USE_ID);TapStallChip(chipData.STALL_USE_ID)}else if(chipData.STALLIDLEID&&$("#"+C_UNAVALIABLECHIPID+chipData.STALLIDLEID).length==1){TapUnavailableArea(C_UNAVALIABLECHIPID+chipData.STALLIDLEID);ScrollToShowChip(C_UNAVALIABLECHIPID+chipData.STALLIDLEID);var nLeft=$("#"+C_UNAVALIABLECHIPID+chipData.STALLIDLEID).position().left;var nRow=GetRowNoByChipId(C_UNAVALIABLECHIPID+chipData.STALLIDLEID);drawUnavailableAreaAtPos(nLeft,nRow);$("#"+C_MOVINGUNAVALIABLECHIPID+
" .ShadowBox").css("display","none")}else{var nRowNum=1;var strOtherDtChipId;if(chipData.STALL_USE_ID){gOtherDtChipObj=new ReserveChip(chipData.STALL_USE_ID);strOtherDtChipId=chipData.STALL_USE_ID}else{gOtherDtChipObj=new UnavailableChip(chipData.STALLIDLEID);strOtherDtChipId=C_UNAVALIABLECHIPID+chipData.STALLIDLEID}gOtherDtChipObj.setChipParameter(chipData);gOtherDtChipObj.createChip(C_CHIPTYPE_OTHER_DAY);nRowNum=$("#stallId_"+gOtherDtChipObj.stallId).position().top/C_CELL_HEIGHT+1;$("#"+strOtherDtChipId).css("top",
$(".stallNo"+nRowNum).position().top+2+"px").css("left","7px").css("width","130px").css("height","70px").css("opacity",C_OPACITY_TRANSPARENT);AdjustChipItemByWidth(strOtherDtChipId);var nOffsetRows=nRowNum-($(".ChipArea_trimming").height()-C_CHIPAREA_OFFSET_TOP)/C_CELL_HEIGHT;if(nOffsetRows>0){var nTop=nOffsetRows*C_CELL_HEIGHT;$(".ChipArea_trimming").SmbFingerScroll({action:"move",moveY:nTop,moveX:0})}if(chipData!=null&&chipData.STALL_USE_ID=="-1")gSelectedChipId=C_COPYCHIPID;else gSelectedChipId=
C_OTHERDTCHIPID;$("#"+strOtherDtChipId).unbind().bind("chipTap",function(e){SetChipUnSelectedStatus();SetTableUnSelectedStatus()});SetTableSelectedStatus();setRedTimeLineLeftPos(false);if(gOtherDtChipObj.scheDeliDateTime&&IsDefaultDate(gOtherDtChipObj.scheDeliDateTime)==false){var dtDeliDelay=GetDeliDelayExpectedTimeLine(gOtherDtChipObj.carWashNeedFlg,gOtherDtChipObj.scheDeliDateTime,gOtherDtChipObj.svcStatus,gOtherDtChipObj.remainingInspectionType);var setPosition=GetTimeLinePosByTime(dtDeliDelay);
$(".TimingLineDeli").css("left",setPosition);$(".TimingLineDeli").css("visibility","visible")}CreateFooterButton(C_FT_DISPTP_SELECTED,C_FT_BTNTP_CHANGING_DATE)}}SetLaterStallColorRed();setTimeout(function(){ChangeAllStallChipCarNoTextAlign()},0)}
function ShowLatestChips(jsonData,bNotCloseDetailFlg,bRowLockVersionFlg){bRefreshFlg=true;var chipDataList=$.parseJSON(jsonData);var arrDuplicateChipsId=new Array;for(var strKey in chipDataList){var chipData=chipDataList[strKey];var objChip=new ReserveChip(strKey);objChip.setChipParameter(chipData);if(objChip.partsFlg=="")if(gArrObjChip[objChip.stallUseId])objChip.setPartsFlg(gArrObjChip[objChip.stallUseId].partsFlg);if(objChip.cancelFlg=="1"){if($("#"+objChip.stallUseId).length>0){RemoveChipFromStall(objChip.stallUseId);
if(gSelectedChipId==objChip.stallUseId){SetChipUnSelectedStatus();SetTableUnSelectedStatus()}}DeleteChipFromRelationChipObj(objChip.stallUseId);continue}if(objChip.stallUseStatus==C_STALLUSE_STATUS_NOSHOW||objChip.tempFlg==C_TEMP_FLG_ON){if($("#"+objChip.stallUseId).length>0){RemoveChipFromStall(objChip.stallUseId);if(gSelectedChipId==objChip.stallUseId){SetChipUnSelectedStatus();SetTableUnSelectedStatus()}}continue}if(objChip.displayStartDate>=gEndWorkTime||objChip.displayEndDate<=gStartWorkTime){if($("#"+
chipData.STALL_USE_ID).length)RemoveChipFromStall(chipData.STALL_USE_ID);continue}if($("#stallId_"+objChip.stallId).length==0){if($("#"+objChip.stallUseId).length>0){RemoveChipFromStall(objChip.stallUseId);if(gSelectedChipId==objChip.stallUseId){SetChipUnSelectedStatus();SetTableUnSelectedStatus()}}continue}if(gArrObjChip[objChip.stallUseId])if(gArrObjChip[objChip.stallUseId].stallUseStatus==C_STALLUSE_STATUS_START)if($("#WB"+objChip.stallUseId).length>0)$("#WB"+objChip.stallUseId).remove();strKey=
chipData.STALL_USE_ID;if(gArrObjChip[strKey]){if(objChip.rowLockVersion>=gArrObjChip[strKey].rowLockVersion||bRowLockVersionFlg){var strBackAddWorkStatus=gArrObjChip[strKey].addWorkStatus;gArrObjChip[strKey]=objChip;if(gArrObjChip[strKey].addWorkStatus.toString().Trim()=="")gArrObjChip[strKey].setAddWorkStatus(strBackAddWorkStatus);var bHasBlackBackFlg=false;if($("#"+strKey+" .Front").hasClass("BlackBack"))bHasBlackBackFlg=true;gArrObjChip[strKey].updateStallChip();if(bHasBlackBackFlg)$("#"+strKey+
" .Front").addClass("BlackBack");SetChipPosition(strKey,"","","")}}else{gArrObjChip[strKey]=objChip;gArrObjChip[strKey].createChip(C_CHIPTYPE_STALL_FASTER);FasterSetChipPosition(gArrObjChip[strKey]);BindChipClickEvent(strKey)}}for(var nWork=0;nWork<$(".StWork").length;nWork++)arrDuplicateChipsId.push($(".StWork")[nWork].id);for(var nWComplete=0;nWComplete<$(".StWComplete").length;nWComplete++)arrDuplicateChipsId.push($(".StWComplete")[nWComplete].id);for(var nDComplete=0;nDComplete<$(".StDComplete").length;nDComplete++)arrDuplicateChipsId.push($(".StDComplete")[nDComplete].id);
for(var strChipId in arrDuplicateChipsId){if(CheckgArrObjChip(arrDuplicateChipsId[strChipId])==false)continue;if(gSelectedChipId){var arrDuplChipIds=GetDuplicateChips(arrDuplicateChipsId[strChipId]);if(arrDuplChipIds.length>1){var bSelectedFlg=false;for(var nLoop=0;nLoop<arrDuplChipIds.length;nLoop++)if(arrDuplChipIds[nLoop][0]==gSelectedChipId){bSelectedFlg=true;break}if(bSelectedFlg)continue}}CreateWhiteBorders(arrDuplicateChipsId[strChipId])}if(gSelectedChipId!=""){ShowRelationLine(gSelectedChipId);
SetTableSelectedStatus()}SetLaterStallColorRed();setTimeout(function(){ChangeAllStallChipCarNoTextAlign()},0)}function RefreshPlanDeliTime(strJsonData){var chipDataList=$.parseJSON(strJsonData);for(var strKey in chipDataList){var chipData=chipDataList[strKey];SetPlanDeliTime(chipData.SVCIN_ID,chipData.DELI_DELAY_DATETIME,chipData.REMAINING_INSPECTION_TYPE)}SetLaterStallColorRed()}
function SetPlanDeliTime(nSvcinId,dtPlanDeli,strInspection){for(var strId in gArrObjChip){if(CheckgArrObjChip(strId)==false)continue;if(gArrObjChip[strId].svcInId==nSvcinId){gArrObjChip[strId].setPlanDelayDate(dtPlanDeli);gArrObjChip[strId].setRemainingInspectionType(strInspection)}}}
function ShowCreatedRelationChips(jsonData){var chipDataList=$.parseJSON(jsonData);for(var strKey in chipDataList){var chipData=chipDataList[strKey];if(chipData.CANCEL_FLG=="1")continue;var objChip=new ReserveChip(strKey);objChip.setChipParameter(chipData);if(objChip.stallUseStatus==C_STALLUSE_STATUS_NOSHOW)continue;if(objChip.tempFlg==C_TEMP_FLG_ON)continue;if(objChip.displayStartDate>=gEndWorkTime||objChip.displayEndDate<=gStartWorkTime)continue;if($("#stallId_"+objChip.stallId).length==0)continue;
strKey=chipData.STALL_USE_ID;if(gArrObjChip[strKey]){if(objChip.rowLockVersion>=gArrObjChip[strKey].rowLockVersion){var strBackAddWorkStatus=gArrObjChip[strKey].addWorkStatus;gArrObjChip[strKey]=objChip;if(gArrObjChip[strKey].addWorkStatus.toString().Trim()=="")gArrObjChip[strKey].setAddWorkStatus(strBackAddWorkStatus);gArrObjChip[strKey]=objChip;var bBlackFlg=false;if($("#"+strKey+" .Front").hasClass("BlackBack"))bBlackFlg=true;gArrObjChip[strKey].updateStallChip();if(bBlackFlg)$("#"+strKey+" .Front").addClass("BlackBack");
SetChipPosition(strKey,"","","")}}else{var strCopyedChipId=GetCopyedChipId(objChip.stallId,objChip.scheStartDateTime,objChip.scheWorkTime);if(strCopyedChipId!=""){gArrObjChip[strKey]=new ReserveChip(strKey);objChip.copy(gArrObjChip[strKey]);if($("#"+strCopyedChipId+" .ICAddWork").length==1)gArrObjChip[strKey].setAddWorkStatus(C_AW_ADDINGWORK);else if($("#"+strCopyedChipId+" .ICWaitCommited").length==1)gArrObjChip[strKey].setAddWorkStatus(C_AW_WAIT_COMMITTED);$("#"+strCopyedChipId).attr("id",strKey);
var bBlackFlg=false;if($("#"+strKey+" .Front").hasClass("BlackBack"))bBlackFlg=true;gArrObjChip[strKey].updateStallChip();if(bBlackFlg)$("#"+strKey+" .Front").addClass("BlackBack");SetChipPosition(strKey,"","","");gArrObjChip[strCopyedChipId]=null;BindChipClickEvent(strKey)}}}if(gSelectedChipId!="")ShowRelationLine(gSelectedChipId);SetLaterStallColorRed();AllButtonRefresh()}
function GetCopyedChipId(nStallId,dtStartTime,nWorkTime){for(var nLoop=0;nLoop<C_ARR_COPYEDCHIPID.length;nLoop++)if(gArrObjChip[C_ARR_COPYEDCHIPID[nLoop]])if(nStallId==gArrObjChip[C_ARR_COPYEDCHIPID[nLoop]].stallId&&dtStartTime-gArrObjChip[C_ARR_COPYEDCHIPID[nLoop]].scheStartDateTime==0&&nWorkTime-gArrObjChip[C_ARR_COPYEDCHIPID[nLoop]].scheWorkTime==0)return C_ARR_COPYEDCHIPID[nLoop];return""}
function RemoveAllStallChips(){gSelectedChipId="";gSelectedCellId="";gWBChipId="";gMovingChipObj=null;gOtherDtChipObj=null;gArrBackChipObj.length=0;gShowLaterStallFlg=false;gPopupBoxId="";$(".MCp").remove();$(".WhiteBorder").remove();$(".PopUpChipBoxBorder").remove();$(".RelationalLine").remove();$("."+C_UNAVALIABLECHIPID).remove();$(".RestArea").remove();gArrObjChip=new Array}
function TapStallChip(strChipId){var strSelectedChipId;var strsubchipFlg=0;var scrollMainObjPos=$(".ChipArea_trimming").find(".scroll-inner").position();gTranslateValStallX=scrollMainObjPos.left;gTranslateValStallY=scrollMainObjPos.top;if(IsCopyedChip(strChipId)&&!gCopyChipObj)return;if($("#"+strChipId).data(C_DATA_CHIPTAP_FLG)==false)return;if($("#"+strChipId+" .Front").hasClass("BlackBack")==true)return;if(gSelectedChipId!=""){if(gArrObjSubChip[gSelectedChipId]){if($("#MovingChip").css("left")&&
$("#MovingChip").css("left")!=gSubMovingChipLeft)return;if(gArrObjSubChip[gSelectedChipId].svcInId==gArrObjChip[strChipId].svcInId&&gArrObjSubChip[gSelectedChipId].subChipAreaId==C_RECEPTION)strsubchipFlg=1;else if(gArrObjSubChip[gSelectedChipId].subChipAreaId==C_RECEPTION||gArrObjSubChip[gSelectedChipId].subChipAreaId==C_NOSHOW||gArrObjSubChip[gSelectedChipId].subChipAreaId==C_STOP)return;else{SetChipUnSelectedStatus();SetTableUnSelectedStatus();SetSubChipBoxClose();CreateFooterButton(C_FT_DISPTP_UNSELECTED,
0);return}}else{var strUpDataType=GetChipUpdatetype(strChipId);if(strUpDataType==C_UPDATA_SUBCHIP)return}if(strChipId==C_NEWCHIPID)return;strSelectedChipId=gSelectedChipId;SetTableUnSelectedStatus();SetChipUnSelectedStatus();if(strSelectedChipId==strChipId)return}if(!strsubchipFlg)SetSubChipBoxClose();gSelectedChipId=strChipId;if(gShowLaterStallFlg==true){ShowAllStall();ScrollToShowChip(strChipId);var scrollMainObjPos=$(".ChipArea_trimming").find(".scroll-inner").position();gTranslateValStallX=scrollMainObjPos.left;
gTranslateValStallY=scrollMainObjPos.top}if(strChipId!=C_NEWCHIPID){drawSelectedChipAtPos($("#"+strChipId).position().left,GetRowNoByChipId(strChipId));$("#"+strChipId).appendTo($("#"+strChipId).offsetParent())}SetTableSelectedStatus();if(gArrObjChip[strChipId])if(IsDefaultDate(gArrObjChip[strChipId].scheDeliDateTime)==false&&gArrObjChip[strChipId].svcStatus!=C_SVCSTATUS_DELIVERY){var dtScheDeliLater=GetDeliDelayExpectedTimeLine(gArrObjChip[strChipId].carWashNeedFlg,gArrObjChip[strChipId].scheDeliDateTime,
gArrObjChip[strChipId].svcStatus,gArrObjChip[strChipId].remainingInspectionType);setPosition=GetTimeLinePosByTime(dtScheDeliLater);$(".TimingLineDeli").css("left",setPosition);$(".TimingLineDeli").css("visibility","visible")}ShowRelationLine(strChipId);if(strsubchipFlg){$("#"+strSelectedChipId+" .Front").removeClass("BlackBack");$("#"+strSelectedChipId).addClass("SelectedChipShadow")}if($("#hidRestAutoJudgeFlg").val()=="1"){var nOverDaysType=GetChipOverDaysType(strChipId);if(C_OVERDAYS_NONE<nOverDaysType){var jsonData=
{Method:"GetCanRestChange",ShowDate:$("#hidShowDate").val(),StallUseId:gArrObjChip[strChipId].stallUseId};DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}else{var canRestChange=CanRestChange(strChipId);CreateFooterButton(C_FT_DISPTP_SELECTED,GetChipType(strChipId),gArrObjChip[strChipId].tlmContractFlg,canRestChange)}}else CreateFooterButton(C_FT_DISPTP_SELECTED,GetChipType(strChipId),gArrObjChip[strChipId].tlmContractFlg,false)}
function ShowRightTimingBalloon(){if($("#"+C_MOVINGCHIPID).length==1)strChipId=C_MOVINGCHIPID;else if($("#"+C_MOVINGUNAVALIABLECHIPID).length==1)strChipId=C_MOVINGUNAVALIABLECHIPID;else if($("#"+C_NEWCHIPID).length==1)strChipId=C_NEWCHIPID;else return;var nChipWidth=$("#"+strChipId).width();var nChipLeft=$("#"+strChipId).position().left;var nRow=GetRowNoByChipId(strChipId);var nChipTop=$(".stallNo"+nRow).position().top;var nTimingBalloonLeft=nChipLeft+nChipWidth+$(".ChipAreaBkGround").position().left-
3+$(".scroll-inner").position().left;var nTimingBalloonTop=nChipTop+8+$(".scroll-inner").position().top;var dtShowDate=GetTimeByXPos(nChipLeft+nChipWidth);$(".Timing_Balloon .Time").html(add_zero(dtShowDate.getHours())+"："+add_zero(dtShowDate.getMinutes()));$(".Timing_Balloon").css({"top":nTimingBalloonTop+"px","left":nTimingBalloonLeft+"px"})}
function ShowLeftTimingBalloon(){var strChipId;if($("#"+C_MOVINGCHIPID).length==1)strChipId=C_MOVINGCHIPID;else if($("#"+C_MOVINGUNAVALIABLECHIPID).length==1)strChipId=C_MOVINGUNAVALIABLECHIPID;else if($("#"+C_NEWCHIPID).length==1)strChipId=C_NEWCHIPID;else return;var nChipWidth=$("#"+strChipId).width();var nChipLeft=$("#"+strChipId).position().left;var nRow=GetRowNoByChipId(strChipId);var nChipTop=$(".stallNo"+nRow).position().top;var nTimingBalloonLeft=nChipLeft+$(".ChipAreaBkGround").position().left-
3+$(".scroll-inner").position().left;var nTimingBalloonTop=nChipTop+8+$(".scroll-inner").position().top;dtShowDate=GetTimeByXPos(nChipLeft-1);$(".Timing_Balloon .Time").html(add_zero(dtShowDate.getHours())+"："+add_zero(dtShowDate.getMinutes()));$(".Timing_Balloon").css({"top":nTimingBalloonTop+"px","left":nTimingBalloonLeft+"px"})}function HideTimingBalloon(){$(".Timing_Balloon").css({"top":-999+"px","left":-999+"px"})}
function ActiveStallChipWithLinkSubChip(strSvcInId){var arrRtChipIds=new Array;if(gShowLaterStallFlg==true)ShowAllStall();SetTableSelectedStatus();var arrRelationChipIds=FindRelationChips("",strSvcInId);if(arrRelationChipIds.length>0){ShowRelationLine(arrRelationChipIds[0][0]);for(var nLoop=0;nLoop<arrRelationChipIds.length;nLoop++)arrRtChipIds.push(arrRelationChipIds[nLoop][0])}return arrRtChipIds}
function UpdateChipColorByDelayDate(strChipId){var arrRelationChips=FindRelationChips(strChipId,"");if(arrRelationChips.length==0)gArrObjChip[strChipId].refleshChipRedColor();else for(var nLoop=0;nLoop<arrRelationChips.length;nLoop++)if(gArrObjChip[arrRelationChips[nLoop][0]])gArrObjChip[arrRelationChips[nLoop][0]].refleshChipRedColor();SetLaterStallColorRed()}
function BindChipClickEvent(strChipId){$("#"+strChipId).bind("chipTap",function(e){if(GetDisplayPopupWindow())return;$("#"+strChipId+" .Front").stop(true,true).removeClass("TapBlueBack");setTimeout(function(){TapStallChip(strChipId)},0)}).bind(C_TOUCH_START,function(e){gOnTouchingFlg=true;if($("#"+strChipId+" .Front").hasClass("BlackBack"))return;$("#"+strChipId+" .Front").stop(true,true).addClass("TapBlueBack")}).bind(C_TOUCH_MOVE+" "+C_TOUCH_END,function(e){gOnTouchingFlg=false;$("#"+strChipId+
" .Front").stop(true,true).removeClass("TapBlueBack")})}
function BindMovingChipTapEvent(){$("#"+C_MOVINGCHIPID).bind("chipTap",function(e){if(GetDisplayPopupWindow())return;$("#"+gSelectedChipId+" .Front").removeClass("TapBlueBack");$("#"+C_MOVINGCHIPID+" .Front").removeClass("TapBlueBack").addClass("BlackBack");setTimeout(function(){TapMovingChip()},0);gCanTbRowTapFlg=false}).bind(C_TOUCH_START,function(e){gOnTouchingFlg=true;if($("#"+C_MOVINGCHIPID+" .CpInner").css("visibility")=="hidden")$("#"+gSelectedChipId+" .Front").addClass("TapBlueBack");else $("#"+
C_MOVINGCHIPID+" .Front").removeClass("BlackBack").addClass("TapBlueBack")}).bind(C_TOUCH_END,function(e){$("#"+gSelectedChipId+" .Front").removeClass("TapBlueBack");$("#"+C_MOVINGCHIPID+" .Front").removeClass("TapBlueBack").addClass("BlackBack");gOnTouchingFlg=false}).bind(C_TOUCH_MOVE,function(e){$("#"+gSelectedChipId+" .Front").removeClass("TapBlueBack");$("#"+C_MOVINGCHIPID+" .Front").removeClass("TapBlueBack").addClass("BlackBack");gOnTouchingFlg=false})}
function TapMovingChip(){var nMovingChipLeft,nMovingChipWidth;var nBackWidth;var strChipId=gSelectedChipId;var strRelationSubChip=GetRelationSubChipId(strChipId);if($("#"+C_MOVINGCHIPID).length==0)return;nMovingChipLeft=$("#"+C_MOVINGCHIPID).position().left;nMovingChipWidth=$("#"+C_MOVINGCHIPID).width();var nBackLeft,nBackRow;var nRow=GetRowNoByChipId(C_MOVINGCHIPID);if(gSelectedChipId!=C_OTHERDTCHIPID&&gSelectedChipId!=C_COPYCHIPID){if(nBackWidth==null)nBackWidth=$("#"+strChipId).width();nCompareWidth=
gArrObjChip[strChipId].scheWorkTime*C_CELL_WIDTH/15-1;nBackLeft=$("#"+strChipId).position().left;nBackRow=GetRowNoByChipId(strChipId);var nOverDaysType=GetChipOverDaysType(strChipId);if(nOverDaysType>C_OVERDAYS_NONE)switch(nOverDaysType){case C_OVERDAYS_LEFT:if($("#"+C_MOVINGCHIPID+" .TimeKnobPointL").length==0)if(Math.abs(nMovingChipWidth-nBackWidth)<1&&GetChipUpdatetype(strChipId)==C_UPDATA_STALLCHIP){SetTableUnSelectedStatus();SetChipUnSelectedStatus();return}break;case C_OVERDAYS_RIGHT:if($("#"+
C_MOVINGCHIPID+" .TimeKnobPointR").length==0&&GetChipUpdatetype(strChipId)==C_UPDATA_STALLCHIP)if(Math.abs(nMovingChipWidth-nBackWidth)<1){SetTableUnSelectedStatus();SetChipUnSelectedStatus();return}break;case C_OVERDAYS_BOTH:if($("#"+C_MOVINGCHIPID+" .TimeKnobPointR").length==0&&$("#"+C_MOVINGCHIPID+" .TimeKnobPointL").length==0)if(Math.abs(nMovingChipWidth-nBackWidth)<1&&GetChipUpdatetype(strChipId)==C_UPDATA_STALLCHIP){SetTableUnSelectedStatus();SetChipUnSelectedStatus();return}break}else if((nMovingChipLeft==
nBackLeft||nMovingChipLeft<1)&&Math.abs(nCompareWidth-nMovingChipWidth)<1&&nRow==nBackRow&&GetChipUpdatetype(strChipId)==C_UPDATA_STALLCHIP){SetTableUnSelectedStatus();SetChipUnSelectedStatus();return}else if(IsDefaultDate(gArrObjChip[strChipId].rsltEndDateTime)==false)if(GetChipUpdatetype(strChipId)!=C_UPDATA_STALLCHIP)return;else{SetTableUnSelectedStatus();SetChipUnSelectedStatus();return}}if(CheckChipPos(C_MOVINGCHIPID)==false){ShowSC3240101Msg(906);if(gSelectedChipId==C_OTHERDTCHIPID){$("#"+C_MOVINGCHIPID).remove();
gMovingChipObj=null;$("#"+gOtherDtChipObj.stallUseId).css("visibility","visible")}else if(gSelectedChipId==C_COPYCHIPID){SetTableUnSelectedStatus();SetChipUnSelectedStatus()}else{if(!gArrObjSubChip[strChipId]){$("#"+strChipId).css("left",nBackLeft);$("#"+strChipId).css("width",nBackWidth);AdjustChipItemByWidth(strChipId)}SetTableUnSelectedStatus();SetChipUnSelectedStatus()}return}if($("#hidRestAutoJudgeFlg").val()!="1"){var arrRestTime=GetRestTimeInServiceTime(C_MOVINGCHIPID);if(arrRestTime.length>
0){ShowRestTimeDialog(arrRestTime[0][0],C_ACTION_MOVE);return}}MoveChip(null)}
function MoveChip(nRestFlg){var strChipId=gSelectedChipId;var nMovingChipLeft=$("#"+C_MOVINGCHIPID).position().left;var nTapXPos=nMovingChipLeft;var nMovingChipWidth=$("#"+C_MOVINGCHIPID).width();var bOtherDtChipFlg=false;var nBackWidth;var nBackLeft;var nBackRow;var tempChipObject=new ReserveChip(strChipId);if(0<strChipId)gArrObjChip[strChipId].copy(tempChipObject);else if(strChipId==C_OTHERDTCHIPID)gOtherDtChipObj.copy(tempChipObject);else gCopyChipObj.copy(tempChipObject);if(tempChipObject.roNum.Trim()!=
""){var afterMovingEndTime=GetTimeByXPos(nMovingChipLeft+nMovingChipWidth);tempChipObject.setDisplayEndDate(afterMovingEndTime);if(IsDelayDelivery(tempChipObject))if(!ConfirmSC3240101Msg(935)){tempChipObject=null;return}}tempChipObject=null;var arrBackDuplicateChipsId=GetDuplicateChips(strChipId);if(gSelectedChipId==C_OTHERDTCHIPID){bOtherDtChipFlg=true;strChipId=gOtherDtChipObj.stallUseId;$("#"+strChipId).css("visibility","visible").css("top","1px").css("height","72px").css("opacity",C_OPACITY);
gArrObjChip[strChipId]=new ReserveChip(strChipId);gOtherDtChipObj.copy(gArrObjChip[strChipId]);nBackWidth=GetWidthByDisplayTime(gOtherDtChipObj.displayStartDate,gOtherDtChipObj.displayEndDate);gOtherDtChipObj=null;gSelectedChipId=gArrObjChip[strChipId].stallUseId;$("#"+gSelectedChipId).unbind();BindChipClickEvent(gSelectedChipId)}else if(gSelectedChipId==C_COPYCHIPID){bOtherDtChipFlg=true;strChipId=C_COPYCHIPID;$("#"+strChipId).css("visibility","visible");$("#"+strChipId).css("top","1px");$("#"+strChipId).css("height",
"72px");$("#"+strChipId).css("opacity",C_OPACITY);strChipId=GetNextCopyedId();$("#"+C_COPYCHIPID).attr("id",strChipId);gArrObjChip[strChipId]=new ReserveChip(strChipId);gCopyChipObj.copy(gArrObjChip[strChipId]);gArrObjChip[strChipId].stallUseId=strChipId;nBackWidth=GetWidthByDisplayTime(gCopyChipObj.displayStartDate,gCopyChipObj.displayEndDate);gCopyChipObj=null;gSelectedChipId=gArrObjChip[strChipId].stallUseId;$("#"+gSelectedChipId).unbind();BindChipClickEvent(gSelectedChipId)}else{nBackWidth=$("#"+
strChipId).width();nBackLeft=$("#"+strChipId).position().left;nBackRow=GetRowNoByChipId(strChipId)}var nRestTimeWidth=0;if($("#hidRestAutoJudgeFlg").val()!="1"){if(nRestFlg!=null)if(nRestFlg==1){var arrRestTime=GetRestTimeInServiceTime(C_MOVINGCHIPID);var nChipLeft=GetLeftByRestTime(C_MOVINGCHIPID,arrRestTime);if(nChipLeft!=nMovingChipLeft){nMovingChipLeft=nChipLeft;$("#"+C_MOVINGCHIPID).css("left",nMovingChipLeft)}nRestTimeWidth=GetWidthByRestTime(C_MOVINGCHIPID);var dtMovedDate=GetTimeByXPos(nChipLeft-
1);if(dtMovedDate-gEndWorkTime>=0){if(bOtherDtChipFlg)$("#"+gSelectedChipId).remove();ShowSC3240101Msg(912);SetTableUnSelectedStatus();SetChipUnSelectedStatus();return}}}else if(IsTodayStartDate(strChipId))nRestTimeWidth=GetWidthByRestTime(C_MOVINGCHIPID);$("#"+strChipId).css("left",nMovingChipLeft);$("#"+strChipId).css("width",nMovingChipWidth+nRestTimeWidth);if(strChipId==gSelectedChipId)$("#"+gSelectedChipId).css("top",1);nBackRow=GetRowNoByChipId(strChipId);var nRow=GetRowNoByChipId(C_MOVINGCHIPID);
if(bOtherDtChipFlg||nBackRow!=nRow)$(".Row"+nRow).append($("#"+strChipId));AdjustChipItemByWidth(strChipId);var arrDuplChipId=GetDuplicateChips(strChipId);if(arrDuplChipId.length>1){ShowSC3240101Msg(906);if(nBackLeft==undefined)$("#"+strChipId).remove();else{$("#"+strChipId).width(nBackWidth);$("#"+strChipId).css("left",nBackLeft);$(".Row"+nBackRow).append($("#"+strChipId))}SetTableUnSelectedStatus();SetChipUnSelectedStatus();CreateWhiteBorders(strChipId);return}var nBackMinutes;var dtBackdispEndDate;
if(gArrObjChip[strChipId]){nBackMinutes=Math.ceil((gArrObjChip[strChipId].displayEndDate-gArrObjChip[strChipId].displayStartDate)/1E3/60);dtBackdispEndDate=gArrObjChip[strChipId].displayEndDate}else{nBackMinutes=Math.ceil((gArrObjSubChip[strChipId].displayEndDate-gArrObjSubChip[strChipId].displayStartDate)/1E3/60);dtBackdispEndDate=gArrObjSubChip[strChipId].displayEndDate}SetChipPrototypeTimeAndStallIdData(strChipId);if($("#hidRestAutoJudgeFlg").val()=="1"){var nOverDaysType=GetChipOverDaysType(strChipId);
if(nOverDaysType==C_OVERDAYS_NONE)gArrObjChip[gSelectedChipId].restFlg=JudgeRestFlg(strChipId)}if($("#"+C_MOVINGCHIPID+" .TimeKnobPointL").length==1){gArrObjChip[strChipId].setScheStartDateTime(gArrObjChip[strChipId].displayStartDate);if(gArrObjRelationChip[strChipId])gArrObjRelationChip[strChipId].setStartDateTime(gArrObjChip[strChipId].displayStartDate)}UpdateChipColorByDelayDate(strChipId);if(GetChipUpdatetype(strChipId)==C_UPDATA_STALLCHIP){var nTapTime=GetTimeByXPos(nTapXPos-1);var nWorkTime=
(gArrObjChip[strChipId].displayEndDate.getTime()-gArrObjChip[strChipId].displayStartDate.getTime())/60/1E3;if($("#"+C_MOVINGCHIPID+" .TimeKnobPointL").length==0){if(IsDefaultDate(gArrObjChip[strChipId].rsltStartDateTime))nTapTime=new Date(gArrObjChip[strChipId].scheStartDateTime);else nTapTime=new Date(gArrObjChip[strChipId].rsltStartDateTime);nWorkTime=gArrObjChip[strChipId].scheWorkTime}if($("#"+C_MOVINGCHIPID+" .TimeKnobPointR").length==0)nWorkTime=gArrObjChip[strChipId].scheWorkTime;setChipDisplayTimeAndStallIdToServer(strChipId,
nRestFlg,nTapTime,nWorkTime);SetTableUnSelectedStatus();SetChipUnSelectedStatus()}else{var strStallId=$(".stallNo"+nRow)[0].id;strStallId=strStallId.substring(8,strStallId.length);gMovingSubChipObj=new MovingSubChip;gMovingSubChipObj.setStallId(strStallId);gMovingSubChipObj.setScheWorkTime(nWorkTime);var startTime=GetTimeByXPos(nMovingChipLeft-1);gMovingSubChipObj.setStartDateTime(startTime);gMovingSubChipObj.selectedChipId=gSelectedChipId;GetReadyMovingUpdate(strChipId,nRestFlg);SetTableUnSelectedStatus();
SetChipUnSelectedStatus();if(gOpenningSubBoxId!="")FooterIconReplace(gOpenningSubBoxId)}var nMaxBorder=$(".Row1").width();if(nMovingChipLeft+nMovingChipWidth+nRestTimeWidth>nMaxBorder){nMovingChipWidth=nMovingChipWidth-(nMovingChipLeft+nMovingChipWidth+nRestTimeWidth-nMaxBorder);$("#"+strChipId).css("width",nMovingChipWidth+nRestTimeWidth)}if(!bOtherDtChipFlg)if(arrBackDuplicateChipsId.length>1)for(var nLoop=0;nLoop<arrBackDuplicateChipsId.length;nLoop++)if(arrBackDuplicateChipsId[nLoop][0]!=strChipId){$("#WB"+
arrBackDuplicateChipsId[nLoop][0]).remove();CreateWhiteBorders(arrBackDuplicateChipsId[nLoop][0])}else $("#WB"+arrBackDuplicateChipsId[nLoop][0]).remove()}function GetNextCopyedId(){if(gLoopCopyedId==9)gLoopCopyedId=0;else gLoopCopyedId++;return C_ARR_COPYEDCHIPID[gLoopCopyedId]}
function BindChipResize(strChipId,nMinWidth,nHandles){if(strChipId==C_MOVINGCHIPID)if(gMovingChipObj==null)return;var strHandles="e, w";if(nHandles==1)strHandles="w";else if(nHandles==2)strHandles="e";if(strChipId==C_MOVINGCHIPID)if(IsDefaultDate(gMovingChipObj.rsltStartDateTime)==false&&IsDefaultDate(gMovingChipObj.rsltEndDateTime)==true)if(nHandles==1){$("#"+C_MOVINGCHIPID).resizable("disable");return}else strHandles="e";else if(IsDefaultDate(gMovingChipObj.rsltEndDateTime)==false){$("#"+C_MOVINGCHIPID).resizable("disable");
return}if(nMinWidth==0)nMinWidth=C_CELL_WIDTH/15*gResizeInterval;var nMaxRight,nMinLeft;var nMovingChipLeft,nMovingChipRight;var nBackMovingChipLeft,nBackWidth;var bEastFlg=true;$("#"+strChipId).resizable("destroy");$("#"+strChipId).resizable({handles:strHandles,minWidth:nMinWidth,grid:C_CELL_WIDTH/15*gResizeInterval,start:function(e,ui){nMaxRight=GetXPosByTime(gEndWorkTime)+1;nMinLeft=GetXPosByTime(gStartWorkTime);var arrLeftPos=new Array;var arrRightPos=new Array;arrLeftPos.push(nMinLeft);arrRightPos.push(nMaxRight);
nMovingChipLeft=$("#"+strChipId).position().left;nMovingChipRight=nMovingChipLeft+$("#"+strChipId).width();nBackMovingChipLeft=nMovingChipLeft;nBackWidth=$("#"+strChipId).width();$("#"+strChipId).offsetParent().children("div").each(function(index,e){if(e.id!=strChipId&&e.id!=gSelectedChipId&&!IsUnavailableArea(e.id)&&!IsRestArea(e.id)){if(e.offsetLeft+e.offsetWidth<nMovingChipLeft)arrLeftPos.push(e.offsetLeft+e.offsetWidth);if(e.offsetLeft>nMovingChipRight)arrRightPos.push(e.offsetLeft)}});arrLeftPos.sort(function(x1,
x2){return x1-x2});arrRightPos.sort(function(x1,x2){return x1-x2});nMinLeft=arrLeftPos[arrLeftPos.length-1];nMaxRight=arrRightPos[0];if($("#"+C_MOVINGCHIPID).length>0)$("#"+C_MOVINGCHIPID+" .CpInner").css("visibility","visible");if($("#"+C_MOVINGUNAVALIABLECHIPID).length>0){$("#"+C_MOVINGUNAVALIABLECHIPID+" .ShadowBox").css("display","");$("#"+C_MOVINGUNAVALIABLECHIPID+" .Front").css("display","")}if(e.srcElement.className.indexOf("ui-resizable-w")>=0)bEastFlg=false;else bEastFlg=true},resize:function(e,
ui){gStopFingerScrollFlg=true;$(".ChipArea_trimming").SmbFingerScroll({action:"stop"});nMovingChipLeft=$("#"+strChipId).position().left;nMovingChipRight=nMovingChipLeft+$("#"+strChipId).width();if($("#"+C_MOVINGCHIPID).length==1){var dtEndDateTime=GetTimeByXPos(nMovingChipRight);var nOffsetMinutes=dtEndDateTime.getMinutes()%gResizeInterval;if(IsDefaultDate(gMovingChipObj.rsltStartDateTime)&&nOffsetMinutes!=0){if(nMovingChipRight<nBackMovingChipLeft+nBackWidth){nMovingChipRight+=Math.floor((gResizeInterval-
nOffsetMinutes)*C_CELL_WIDTH/15);$("#"+strChipId).css("width",nMovingChipRight-nMovingChipLeft)}if(nMovingChipRight>nBackMovingChipLeft+nBackWidth){nMovingChipRight-=Math.ceil(nOffsetMinutes*C_CELL_WIDTH/15);$("#"+strChipId).css("width",nMovingChipRight-nMovingChipLeft)}}}if(nMovingChipLeft<=nMinLeft&&nMovingChipLeft<nBackMovingChipLeft){var nLeftPos=nMovingChipRight-parseInt((nMovingChipRight-nMinLeft)/C_CELL_WIDTH)*C_CELL_WIDTH+1;var nWidth=nMovingChipRight-nLeftPos;$("#"+strChipId).css("left",
nLeftPos).css("width",nWidth)}if(nMovingChipRight>=nMaxRight&&nMovingChipRight>nBackMovingChipLeft+nBackWidth){var nWidth=parseInt((nMaxRight+2-nMovingChipLeft)/C_CELL_WIDTH)*C_CELL_WIDTH-1;$("#"+strChipId).css("width",nWidth)}AdjustChipItemByWidth(strChipId);SetTimeKnobPointRPosbyChipWidth(strChipId);if(bEastFlg)ShowRightTimingBalloon();else ShowLeftTimingBalloon()},stop:function(e,ui){if($("#"+C_MOVINGUNAVALIABLECHIPID).length>0){var nAfterMovingWidth=$("#"+C_MOVINGUNAVALIABLECHIPID).width();var nChangeWidth=
nAfterMovingWidth-nBackWidth;var nChangeMinutes=15/C_CELL_WIDTH*nChangeWidth;var nIdleTime=parseInt($("#"+gSelectedChipId).data("IDLE_TIME"));nIdleTime+=nChangeMinutes;$("#"+gSelectedChipId).data("IDLE_TIME",nIdleTime)}HideTimingBalloon();if(strChipId==C_NEWCHIPID)SetChipPrototypeTimeAndStallIdData(C_NEWCHIPID)}});$(".ui-resizable-e").bind(C_TOUCH_START,function(e){ShowRightTimingBalloon()}).bind(C_TOUCH_END,function(event){HideTimingBalloon()});$(".ui-resizable-w").bind(C_TOUCH_START,function(e){ShowLeftTimingBalloon()}).bind(C_TOUCH_END,
function(event){HideTimingBalloon()})}
function BindPopUpChipTapEvent(strChipId){$("#"+strChipId).bind("chipTap",function(e){if($("#"+strChipId+" .Front").hasClass("BlackBack")==true)return;var nDisplayPopWnd=GetDisplayPopupWindow();if(nDisplayPopWnd>C_DISP_NONE&&nDisplayPopWnd!=C_DISP_DUPL)return;strChipId=strChipId.substring(5,strChipId.length);if(gSelectedChipId!=""){SetTableUnSelectedStatus();SetChipUnSelectedStatus()}if(gWBChipId.substring(2,gWBChipId.length)==strChipId)$("#"+gWBChipId).remove();RemovePopUpBox();TapStallChip(strChipId)})}
function FindRelationChips(strStallUseId,strSvcinId){var arrRelationChipId=new Array;if(strSvcinId=="")if(gArrObjRelationChip[strStallUseId])strSvcinId=gArrObjRelationChip[strStallUseId].svcinId;else return arrRelationChipId;var nLoop=0;for(var strId in gArrObjRelationChip)if(gArrObjRelationChip[strId])if(gArrObjRelationChip[strId].svcinId==strSvcinId){arrRelationChipId[nLoop]=new Array(strId,gArrObjRelationChip[strId].startDateTime);nLoop++}arrRelationChipId.sort(function(x,y){return x[1]-y[1]});
return arrRelationChipId}function FindChipsBySvcinId(strSvcinId){var arrRelationChipId=new Array;for(var strId in gArrObjChip){if(CheckgArrObjChip(strId)==false)continue;if(gArrObjChip[strId]&&IsCopyedChip(strId)==false)if(gArrObjChip[strId].svcInId==strSvcinId)arrRelationChipId.push(strId)}return arrRelationChipId}
function HasWorkingChipInRelation(strChipId){var strSvcInId=gArrObjChip[strChipId].svcInId;for(var strId in gArrObjChip){if(CheckgArrObjChip(strId)==false)continue;if(gArrObjChip[strId].svcInId==strSvcInId)if(IsDefaultDate(gArrObjChip[strId].rsltStartDateTime)==false&&IsDefaultDate(gArrObjChip[strId].rsltEndDateTime)==true)return true}return false}
function GetStallIdOfRelationChip(strChipId){var strSvcInId=gArrObjChip[strChipId].svcInId;for(var strId in gArrObjChip){if(CheckgArrObjChip(strId)==false)continue;if(gArrObjChip[strId].svcInId==strSvcInId)if(IsDefaultDate(gArrObjChip[strId].rsltStartDateTime)==false&&IsDefaultDate(gArrObjChip[strId].rsltEndDateTime)==true)return gArrObjChip[strId].stallId}return undefined}
function ShowRelationLine(strChipId){if(IsRelationChip(strChipId)==false)return;var arrRelationChipId=FindRelationChips(strChipId,"");var nRelationCnt=arrRelationChipId.length;for(var nLoop=nRelationCnt-1;nLoop>=0;nLoop--)if(!gArrObjChip[arrRelationChipId[nLoop][0]])if(arrRelationChipId[nLoop][1]-gStartWorkTime>=0&&arrRelationChipId[nLoop][1]-gEndWorkTime<0){arrRelationChipId.splice(nLoop,1);nRelationCnt--}if(nRelationCnt==1)return;if(gArrObjChip[arrRelationChipId[0][0]]){var objRelationalR1=$("<div />").addClass("PointR");
$("#"+arrRelationChipId[0][0]).append(objRelationalR1);$("#"+arrRelationChipId[0][0]+" .PointR").removeClass("ArrowR").css("visibility","visible")}if(gArrObjChip[arrRelationChipId[nRelationCnt-1][0]]){var objRelationalL1=$("<div />").addClass("PointL");$("#"+arrRelationChipId[nRelationCnt-1][0]).append(objRelationalL1);$("#"+arrRelationChipId[nRelationCnt-1][0]+" .PointL").removeClass("ArrowL").css("visibility","visible")}for(var nLoop=0;nLoop<nRelationCnt;nLoop++){var objRelationalL=$("<div />").addClass("PointL");
var objRelationalR=$("<div />").addClass("PointR");var strRelationChipId=arrRelationChipId[nLoop][0];if(!gArrObjChip[strRelationChipId])continue;if(nLoop!=0&&nLoop!=nRelationCnt-1){$("#"+strRelationChipId).append(objRelationalL).append(objRelationalR);$("#"+strRelationChipId+" .PointR").removeClass("ArrowR").css("visibility","visible");$("#"+strRelationChipId+" .PointL").removeClass("ArrowL").css("visibility","visible")}if(nLoop>0)if(!gArrObjChip[arrRelationChipId[nLoop-1][0]])$("#"+arrRelationChipId[nLoop][0]+
" .PointL").addClass("ArrowL RelationLineZIndex");if(nLoop+1<nRelationCnt)if(gArrObjChip[arrRelationChipId[nLoop+1][0]]){var nStartRowNum=GetRowNoByChipId(arrRelationChipId[nLoop][0]);var nEndRowNum=GetRowNoByChipId(arrRelationChipId[nLoop+1][0]);DrawRelationLine("Line"+arrRelationChipId[nLoop][0],$("#"+arrRelationChipId[nLoop][0]).position().left+$("#"+arrRelationChipId[nLoop][0]).width(),$(".Row"+nStartRowNum).position().top+((C_CELL_HEIGHT+1)/2-1),$("#"+arrRelationChipId[nLoop+1][0]).position().left,
$(".Row"+nEndRowNum).position().top+(C_CELL_HEIGHT+1)/2-1)}else $("#"+arrRelationChipId[nLoop][0]+" .PointR").addClass("ArrowR RelationLineZIndex")}}function IsRelationChip(strChipId){if(strChipId==undefined||gArrObjRelationChip==undefined||gArrObjRelationChip==null)return false;if(strChipId==C_OTHERDTCHIPID)return false;if(gArrObjRelationChip[strChipId])return true;else return false}
function IsTodayPage(){var dtShowDate=new Date($("#hidShowDate").val());var dtTodayDate=GetServerTimeNow();if(dtShowDate.getFullYear()!=dtTodayDate.getFullYear()||dtShowDate.getMonth()!=dtTodayDate.getMonth()||dtShowDate.getDate()!=dtTodayDate.getDate())return false;else return true}
function IsStartWorkDate(dtDate){var dtTodayStartDate=GetServerTimeNow();dtTodayStartDate.setHours(gStartWorkTime.getHours());dtTodayStartDate.setMinutes(gStartWorkTime.getMinutes());dtTodayStartDate.setSeconds(0);dtTodayStartDate.setMilliseconds(0);var dtTodayEndDate=GetServerTimeNow();dtTodayEndDate.setHours(gEndWorkTime.getHours());dtTodayEndDate.setMinutes(gEndWorkTime.getMinutes());dtTodayEndDate.setSeconds(0);dtTodayEndDate.setMilliseconds(0);if(dtTodayStartDate-dtDate>0)return-1;else if(dtDate-
dtTodayEndDate>0)return 1;else return 0}function CompareDate(dtCompare1,dtCompare2){var dt1=new Date(dtCompare1);var dt2=new Date(dtCompare2);dt1.setHours(0);dt1.setMinutes(0);dt1.setSeconds(0);dt1.setMilliseconds(0);dt2.setHours(0);dt2.setMinutes(0);dt2.setSeconds(0);dt2.setMilliseconds(0);if(dt1-dt2>0)return 1;else if(dt1-dt2<0)return-1;else return 0}
function GetChipType(strChipId){if(gSelectedChipId==C_NEWCHIPID)return C_FT_BTNTP_REZ_NEW;var objChip;if(strChipId==C_MOVINGCHIPID)objChip=gMovingChipObj;else objChip=gArrObjChip[strChipId];if(objChip.cstId==0)return C_FT_BTNTP_REZ_KARIKARIREZ;if(objChip.resvStatus==C_RTYPE_TEMP)if(IsDefaultDate(objChip.rsltSvcInDateTime))return C_FT_BTNTP_REZ_TEMP;else return C_FT_BTNTP_REZ_TEMP_CARIN;if(IsDefaultDate(objChip.rsltSvcInDateTime)==true)if(objChip.acceptanceTpye==C_RFLG_RESERVE)return C_FT_BTNTP_REZ_DECIDED;
else return C_FT_BTNTP_WALKIN_DECIDED;var nType=C_FT_BTNTP_WALKIN;if(objChip.stallUseStatus==C_STALLUSE_STATUS_STARTWAIT||objChip.stallUseStatus==C_STALLUSE_STATUS_STARTINCLUDESTOPJOB)if(objChip.stopFlg==true)nType=C_FT_BTNTP_INTERRRUPT_STALL;else{if(objChip.roNum!="")nType=C_FT_BTNTP_RO_PUBLISHED;if(objChip.stallUseStatus==C_STALLUSE_STATUS_STARTWAIT)nType=C_FT_BTNTP_DECIDED_WORKPLAN}if(IsDefaultDate(objChip.rsltStartDateTime)==false){var dtShowDate=new Date($("#hidShowDate").val());if(CompareDate(objChip.rsltStartDateTime,
dtShowDate)==0)nType=C_FT_BTNTP_WORKING;else nType=C_FT_BTNTP_WORKING_NOTSTARTDAY}if(IsDefaultDate(objChip.rsltEndDateTime)==false)nType=C_FT_BTNTP_END_WORK;if(objChip.svcStatus==C_SVCSTATUS_DELIVERY)nType=C_FT_BTNTP_END_DELIVERY;return nType}
function GetChipOverDaysType(strChipId){if(gArrObjChip[strChipId]){var dtStartTime;var dtEndTime;if(IsDefaultDate(gArrObjChip[strChipId].rsltStartDateTime)){dtStartTime=new Date(gArrObjChip[strChipId].scheStartDateTime);dtEndTime=new Date(gArrObjChip[strChipId].scheEndDateTime)}else if(IsDefaultDate(gArrObjChip[strChipId].rsltEndDateTime)){dtStartTime=new Date(gArrObjChip[strChipId].rsltStartDateTime);if(IsDefaultDate(gArrObjChip[strChipId].prmsEndDateTime))dtEndTime=new Date(gArrObjChip[strChipId].scheEndDateTime);
else dtEndTime=new Date(gArrObjChip[strChipId].prmsEndDateTime)}else{dtStartTime=new Date(gArrObjChip[strChipId].rsltStartDateTime);dtEndTime=new Date(gArrObjChip[strChipId].rsltEndDateTime)}var dtShowDate=new Date($("#hidShowDate").val());var nStartTimeCompareResult=CompareDate(dtStartTime,dtShowDate);var nEndTimeCompareResult=CompareDate(dtEndTime,dtShowDate);if(nStartTimeCompareResult<0&&nEndTimeCompareResult>0)return C_OVERDAYS_BOTH;else{if(nStartTimeCompareResult<0)return C_OVERDAYS_LEFT;if(nEndTimeCompareResult>
0)return C_OVERDAYS_RIGHT}}return C_OVERDAYS_NONE}
function GetUnavailableChipOverDaysType(strChipId){var dtStartTime=new Date($("#"+strChipId).data("START_TIME"));var dtEndTime=new Date($("#"+strChipId).data("END_TIME"));var dtShowDate=new Date($("#hidShowDate").val());var nStartTimeCompareResult=CompareDate(dtStartTime,dtShowDate);var nEndTimeCompareResult=CompareDate(dtEndTime,dtShowDate);if(nStartTimeCompareResult<0&&nEndTimeCompareResult>0)return C_OVERDAYS_BOTH;else{if(nStartTimeCompareResult<0)return C_OVERDAYS_LEFT;if(nEndTimeCompareResult>
0)return C_OVERDAYS_RIGHT}return C_OVERDAYS_NONE}
function drawSelectedChipAtPos(nLeft,nRowNo){if(gSelectedChipId=="")return;var strChipId=gSelectedChipId;if(gMovingChipObj==null){var nBackWidth=-1;gMovingChipObj=new ReserveChip(C_MOVINGCHIPID);if(strChipId==C_OTHERDTCHIPID)gOtherDtChipObj.copy(gMovingChipObj);else if(strChipId==C_COPYCHIPID)gCopyChipObj.copy(gMovingChipObj);else{gArrObjChip[strChipId].copy(gMovingChipObj);nBackWidth=$("#"+strChipId).width()}gMovingChipObj.stallUseId=C_MOVINGCHIPID;if(strChipId==C_COPYCHIPID)gMovingChipObj.createChip(C_CHIPTYPE_STALL_COPYMOVING);
else gMovingChipObj.createChip(C_CHIPTYPE_STALL_MOVING);var nWorkTime=gMovingChipObj.scheWorkTime;if(IsDefaultDate(gMovingChipObj.rsltEndDateTime)==false)nWorkTime=gMovingChipObj.rsltWorkTime;var nWidth=nWorkTime*C_CELL_WIDTH/15;if(nWidth<C_CELL_WIDTH/15*gResizeInterval-1)nWidth=C_CELL_WIDTH/15*gResizeInterval;if(strChipId!=C_COPYCHIPID&&strChipId!=C_OTHERDTCHIPID&&IsDefaultDate(gMovingChipObj.rsltEndDateTime)==false&&gArrObjChip[strChipId])nWidth=nBackWidth+1;var nOverDaysType=GetChipOverDaysType(strChipId);
if(nOverDaysType>C_OVERDAYS_NONE){nWidth=$("#"+strChipId).width()+1;switch(nOverDaysType){case C_OVERDAYS_LEFT:$("#"+C_MOVINGCHIPID+" .TimeKnobPointL").remove();BindChipResize(C_MOVINGCHIPID,0,2);break;case C_OVERDAYS_RIGHT:$("#"+C_MOVINGCHIPID+" .TimeKnobPointR").remove();BindChipResize(C_MOVINGCHIPID,0,1);break;case C_OVERDAYS_BOTH:$("#"+C_MOVINGCHIPID+" .TimeKnobPointL").remove();$("#"+C_MOVINGCHIPID+" .TimeKnobPointR").remove();break}}else BindChipResize(C_MOVINGCHIPID,0,0);$("#"+C_MOVINGCHIPID).css("width",
nWidth-1);AdjustChipItemByWidth(C_MOVINGCHIPID);$("#"+C_MOVINGCHIPID+" .CpInner").css("opacity",C_OPACITY_TRANSPARENT);if(nBackWidth!=-1&&Math.abs(nBackWidth-(nWidth-1))<1)$("#"+C_MOVINGCHIPID+" .CpInner").css("visibility","hidden");ChangeChipZIndex(C_MOVINGCHIPID,"MovingChipZIndex");BindMovingChipTapEvent();if(gSelectedChipId!=C_COPYCHIPID&&gSelectedChipId!=C_OTHERDTCHIPID)CreateFooterButton(C_FT_DISPTP_SELECTED,GetChipType(C_MOVINGCHIPID),gArrObjChip[strChipId].tlmContractFlg)}$("#"+C_MOVINGCHIPID).css("left",
nLeft);$(".Row"+nRowNo).append($("#"+C_MOVINGCHIPID))}
function SetChipUnSelectedStatus(){switch(gSelectedChipId){case "":break;case C_NEWCHIPID:$("#"+C_NEWCHIPID).remove();gArrObjChip[C_NEWCHIPID]=null;break;case C_OTHERDTCHIPID:if(gOtherDtChipObj!=null){if(gOtherDtChipObj.stallUseId)$("#"+gOtherDtChipObj.stallUseId).remove();else $("#"+C_UNAVALIABLECHIPID+gOtherDtChipObj.stallIdleId).remove();gOtherDtChipObj=null}if(gMovingChipObj!=null){$("#"+C_MOVINGCHIPID).remove();gMovingChipObj=null}break;case C_COPYCHIPID:if(gCopyChipObj!=null){$("#"+C_COPYCHIPID).remove();
gCopyChipObj=null}if(gMovingChipObj!=null){$("#"+C_MOVINGCHIPID).remove();gMovingChipObj=null}break;default:if(IsUnavailableArea(gSelectedChipId)){$("#"+C_MOVINGUNAVALIABLECHIPID).remove();ChangeChipZIndex(gSelectedChipId,"")}if(gMovingChipObj!=null){$("#"+C_MOVINGCHIPID).remove();gMovingChipObj=null}var arrRelationChipId;if(gArrObjSubChip[gSelectedChipId]){var strSvcInId=GetSubChipSVCINID(gSelectedChipId);arrRelationChipId=FindRelationChips("",strSvcInId)}else arrRelationChipId=FindRelationChips(gSelectedChipId,
"");if(arrRelationChipId.length==0){$("#"+gSelectedChipId).removeClass("SelectedChipShadow");if(gArrObjChip[gSelectedChipId]&&$("#"+gSelectedChipId).length>0)CreateWhiteBorders(gSelectedChipId)}else for(var nLoop=0;nLoop<arrRelationChipId.length;nLoop++){$("#"+arrRelationChipId[nLoop][0]).removeClass("SelectedChipShadow");if(gArrObjChip[arrRelationChipId[nLoop][0]]&&$("#"+arrRelationChipId[nLoop][0]).length>0)CreateWhiteBorders(arrRelationChipId[nLoop][0])}$(".SelectedRelationWorkOverChipZIndex").removeClass("SelectedRelationWorkOverChipZIndex");
break}gSelectedChipId="";gSelectedCellId="";CreateFooterButton(C_FT_DISPTP_UNSELECTED,0);$(".PointR").remove();$(".PointL").remove();$(".RelationalLine").remove();$(".TimingLineDeli").css("visibility","hidden");HideTimingBalloon()}function SetTimeKnobPointRPosbyChipWidth(strChipId){var rCircleLeftPos=$("#"+strChipId).width()-5;$(".TimeKnobPointR").css("left",rCircleLeftPos)}
function CreateNewChip(nRowNo,nColNo){if(gShowLaterStallFlg==true){var nBackupXPos=$(".scroll-inner").position().left;ShowAllStall();$(".ChipArea_trimming").SmbFingerScroll({action:"move",moveY:0,moveX:-nBackupXPos})}var strBackSelectedChipId=gSelectedChipId;gSelectedChipId=C_NEWCHIPID;if(gArrObjChip[C_NEWCHIPID]==undefined)gArrObjChip[C_NEWCHIPID]=new ReserveChip(C_NEWCHIPID);gArrObjChip[C_NEWCHIPID].createChip(C_CHIPTYPE_STALL_NEW);var nLeft=(nColNo-1)*C_CELL_WIDTH+1;var nWidth=C_NEWCHIPID_COLUM_NUM;
if(gMaxCol==nColNo)nWidth=1;else if(gMaxCol-1==nColNo)nWidth=2;$("#BlueDiv").css("visibility","hidden");$("#"+C_NEWCHIPID).css("left",nLeft).css("width",C_CELL_WIDTH*nWidth-1).css("visibility","visible");$(".Row"+nRowNo).append($("#"+C_NEWCHIPID));SetSubChipBoxClose();if(gPopupBoxId!="")RemovePopUpBox();setTimeout(function(){if(CheckChipPos(C_NEWCHIPID)==false){ShowSC3240101Msg(906);SetTableUnSelectedStatus();SetChipUnSelectedStatus();return}BindChipClickEvent(C_NEWCHIPID);BindChipResize(C_NEWCHIPID);
SetTimeKnobPointRPosbyChipWidth(C_NEWCHIPID);CreateFooterButton(C_FT_DISPTP_SELECTED,C_FT_BTNTP_REZ_NEW);SetChipPrototypeTimeAndStallIdData(C_NEWCHIPID);SetTableSelectedStatus()},100)}function GetCellNumByWidth(nWidth){return Math.ceil((nWidth+1)/C_CELL_WIDTH)}function GetRowNoByChipId(strChipId){return Math.round($("#"+strChipId).offsetParent().position().top/C_CELL_HEIGHT+1)}function GetRowNoByYPos(nYPos){return Math.ceil(nYPos/C_CELL_HEIGHT)}
function GetColNoByXPos(nXPos){return Math.floor(nXPos/C_CELL_WIDTH+1)}function GetColNoByTouchXPos(nXPos){return Math.floor((nXPos-C_SCREEN_CHIPAREA_OFFSET_LEFT)/C_CELL_WIDTH+1)}
function SetChipPosition(strChipId,stallId,startTime,endTime){var nTop,nLeft,nWidth;var nRowNo;var hour,minutes;var tStartTime,tEndTime;if(startTime=="")tStartTime=gArrObjChip[strChipId].displayStartDate;else if(typeof startTime=="string"){strStartTime=$("#hidShowDate").val()+" "+startTime+":00";tStartTime=new Date(strStartTime)}else tStartTime=startTime;if(endTime=="")tEndTime=gArrObjChip[strChipId].displayEndDate;else if(typeof endTime=="string"){strEndTime=$("#hidShowDate").val()+" "+endTime+":00";
tEndTime=new Date(strEndTime)}else tEndTime=endTime;if(stallId=="")nStallId=gArrObjChip[strChipId].stallId;else nStallId=stallId;var dtShowDate=new Date($("#hidShowDate").val());if(dtShowDate.getFullYear()!=tStartTime.getFullYear()||dtShowDate.getMonth()!=tStartTime.getMonth()||dtShowDate.getDate()!=tStartTime.getDate()){if(strChipId==gSelectedChipId){$("#"+strChipId).remove();gSelectedChipId="";if(gMovingChipObj){$("#"+C_MOVINGCHIPID).remove();gMovingChipObj=null}}return}nLeft=Math.round(GetXPosByTime(tStartTime))+
1;nWidth=GetWidthByDisplayTime(tStartTime,tEndTime);nRowNo=$("#stallId_"+nStallId).position().top/C_CELL_HEIGHT+1;$("#"+strChipId).css("left",nLeft);$("#"+strChipId).css("width",nWidth);AdjustChipItemByWidth(strChipId);$(".Row"+nRowNo).append($("#"+strChipId))}
function FasterSetChipPosition(objChip){var nLeft=Math.round(GetXPosByTime(objChip.displayStartDate))+1;nWidth=GetWidthByDisplayTime(objChip.displayStartDate,objChip.displayEndDate);$("#"+objChip.stallUseId).css("left",nLeft).css("width",nWidth);FasterAdjustChipItemByWidth(objChip.stallUseId,nWidth)}
function FasterAdjustChipItemByWidth(strChipId,nChipWidth){if(nChipWidth<=C_CELL_WIDTH){$("#"+strChipId+" h3").css("display","none");if($("#"+strChipId+" .infoBox").prev().hasClass("time")==false&&$("#"+strChipId+" .infoBox").prev().html()=="")$("#"+strChipId+" .infoBox").prev().css("display","none");if(nChipWidth<40)$("#"+strChipId+" .infoBox").css("width",nChipWidth-5);else $("#"+strChipId+" .infoBox").css("width",36);if(nChipWidth<35)$("#"+strChipId+" .time").css("width",nChipWidth-3);else $("#"+
strChipId+" .time").css("width",33);if(nChipWidth<26)$("#"+strChipId+" .IC02").css("left",nChipWidth-12);else $("#"+strChipId+" .IC02").css("left",13);if(nChipWidth<18){$("#"+strChipId+" .IC03").css("width",nChipWidth-3);$("#"+strChipId+" .GIcon").css("right",0)}else{$("#"+strChipId+" .IC03").css("width",15);$("#"+strChipId+" .GIcon").css("right",4)}if(nChipWidth<18){$("#"+strChipId+" .IconL").css("right",2);$("#"+strChipId+" .IconL").css("width",nChipWidth-3);$("#"+strChipId+" .IconP").css("right",
2);$("#"+strChipId+" .IconP").css("width",nChipWidth-3);$("#"+strChipId+" .IC03").css("right",2)}else if(nChipWidth<35){$("#"+strChipId+" .IconL").css("right",2);$("#"+strChipId+" .IconP").css("right",2);$("#"+strChipId+" .IC03").css("right",2);$("#"+strChipId+" .IconL").css("width",15);$("#"+strChipId+" .IconP").css("width",15)}else{$("#"+strChipId+" .IconP").css("width",15);$("#"+strChipId+" .IconL").css("width",15);$("#"+strChipId+" .IC03").css("right",4);if($("#"+strChipId).find(".IC03").length){$("#"+
strChipId+" .IconL").css("right",20);$("#"+strChipId+" .IconP").css("right",20)}else{$("#"+strChipId+" .IconL").css("right",4);$("#"+strChipId+" .IconP").css("right",4)}}}else{$("#"+strChipId+" h3").css("display","block");$("#"+strChipId+" .infoBox").prev().css("display","block");$("#"+strChipId+" .infoBox").css("width",36);$("#"+strChipId+" .time").css("width",33);$("#"+strChipId+" .IC02").css("left",13);$("#"+strChipId+" .IC03").css("width",15);$("#"+strChipId+" .GIcon").css("right",4);if($("#"+
strChipId).find(".IC03").length){$("#"+strChipId+" .IconL").css("right",20);$("#"+strChipId+" .IconP").css("right",20)}else{$("#"+strChipId+" .IconL").css("right",4);$("#"+strChipId+" .IconP").css("right",4)}$("#"+strChipId+" .IconL").css("width",15);$("#"+strChipId+" .IconP").css("width",15);if(nChipWidth<60)$("#"+strChipId+" .IC02").css("left",nChipWidth-50)}}
function ChangeCarNoTextAlign(strChipId){if($("#"+strChipId+" .CarNoL").length>0){if($("#"+strChipId+" .CarNoL").width()<=$("#"+strChipId+" .CarNoL span").width())$("#"+strChipId+" .CarNoL").addClass("CarNoR").removeClass("CarNoL")}else if($("#"+strChipId+" .CarNoR").width()>$("#"+strChipId+" .CarNoR span").width())$("#"+strChipId+" .CarNoR").addClass("CarNoL").removeClass("CarNoR")}
function ChangeAllStallChipCarNoTextAlign(){for(var strId in gArrObjChip){if(CheckgArrObjChip(strId)==false)continue;ChangeCarNoTextAlign(strId)}}function AdjustChipItemByWidth(strChipId){var nChipWidth=$("#"+strChipId).width();ChangeCarNoTextAlign(strChipId);FasterAdjustChipItemByWidth(strChipId,nChipWidth)}function CheckgArrObjChip(strChipId){if(gArrObjChip[strChipId]==null||typeof gArrObjChip[strChipId]!="object")return false;else return true}
function GetTimeByXPos(nXPos){var dtDay=new Date($("#hidShowDate").val());dtDay.setHours(gStartWorkTime.getHours());dtDay.setMinutes(0);dtDay.setSeconds(0);dtDay.setMilliseconds(0);var nStartHour=gStartWorkTime.getHours();var nEndHour=gEndWorkTime.getHours();if(gEndWorkTime.getMinutes()>0)nEndHour+=1;var time=nXPos/$(".TbRow").width()*((nEndHour-nStartHour)*60*60*1E3)+dtDay.getTime();dtDay.setTime(time);var nSeconds=dtDay.getSeconds();dtDay.setSeconds(0);dtDay.setMilliseconds(0);if(nSeconds>=30)dtDay.setTime(dtDay.getTime()+
6E4);return dtDay}function GetWidthByDisplayTime(dtStartTime,dtEndTime){var nWidth=Math.round(GetXPosByTime(dtEndTime)-GetXPosByTime(dtStartTime))-1;if(nWidth<C_CELL_WIDTH/15*gResizeInterval-1)nWidth=C_CELL_WIDTH/15*gResizeInterval-1;return nWidth}
function GetXPosByTime(dtDate){var dtTodayStartDate=new Date($("#hidShowDate").val());dtTodayStartDate.setHours(gStartWorkTime.getHours());dtTodayStartDate.setMinutes(0);dtTodayStartDate.setSeconds(0);dtTodayStartDate.setMilliseconds(0);var dtTodayEndDate=new Date($("#hidShowDate").val());var nEndTime=gEndWorkTime.getHours();if(gEndWorkTime.getMinutes()>0)nEndTime+=1;dtTodayEndDate.setHours(nEndTime);dtTodayEndDate.setMinutes(0);dtTodayEndDate.setSeconds(0);dtTodayEndDate.setMilliseconds(0);var rtValue=
(dtDate.getTime()-dtTodayStartDate.getTime())/(dtTodayEndDate.getTime()-dtTodayStartDate.getTime())*(gMaxCol*C_CELL_WIDTH);return rtValue}
function GetTimeLinePosByTime(dtDate){var dt=new Date;dt.setTime(dtDate.getTime());var dtShowDate=new Date($("#hidShowDate").val());var nCompareValue=CompareDate(dtShowDate,dt);if(nCompareValue!=0)return-1;var setPosition;var hour=dt.getHours();var minutes=dt.getMinutes();var nowtime=hour*60+minutes;var starttime=gStartWorkTime.getHours()*60;var endtime=gEndWorkTime.getHours()*60;if(gEndWorkTime.getMinutes()>0)endtime+=60;var nScrollDivWidth=$(".ChipArea").width()-C_CHIPAREA_OFFSET_LEFT;setPosition=
(nowtime-starttime)*nScrollDivWidth/(endtime-starttime)+C_CHIPAREA_OFFSET_LEFT;var nTimeOffset=$(".TimingLine01").offset().left-$(".TimingLineSet").offset().left;setPosition-=nTimeOffset;return setPosition}
function SetChipPrototypeTimeAndStallIdData(strChipId){var rtChangedFlg;var updateType=GetChipUpdatetype(strChipId);if(updateType==C_UPDATA_STALLCHIP)rtChangedFlg=false;else rtChangedFlg=true;if(strChipId==""||strChipId==null||gArrObjChip[strChipId]==null&&gArrObjSubChip[strChipId]==null)return rtChangedFlg;if(IsDefaultDate(gArrObjChip[strChipId].rsltEndDateTime)==false)return false;var strMovingChip;if(strChipId==C_NEWCHIPID)strMovingChip=C_NEWCHIPID;else strMovingChip=C_MOVINGCHIPID;var nMovingChipLeft=
$("#"+strMovingChip).position().left;var nMovingChipWidth=$("#"+strMovingChip).width();var tStartTime=GetTimeByXPos(nMovingChipLeft-1);var tEndTime=GetTimeByXPos(nMovingChipLeft+nMovingChipWidth);var nRowNo=GetRowNoByChipId(strChipId);var strStallId=$(".stallNo"+nRowNo)[0].id;if(strStallId.length>7)strStallId=strStallId.substring(8,strStallId.length);BackupRelationChips(strChipId);var nChangeStartTime=0;var nChangeEndTime=0;if(IsDefaultDate(gArrObjChip[strChipId].rsltStartDateTime)){if(strStallId!=
""&&strStallId!=gArrObjChip[strChipId].stallId){gArrObjChip[strChipId].setStallId(strStallId);rtChangedFlg=true}if($("#"+strMovingChip+" .TimeKnobPointL").length==1){nChangeStartTime=gArrObjChip[strChipId].displayStartDate-tStartTime;if(nChangeStartTime!=0){gArrObjChip[strChipId].setScheStartDateTime(tStartTime);gArrObjChip[strChipId].setDisplayStartDate(tStartTime);rtChangedFlg=true}}if($("#"+strMovingChip+" .TimeKnobPointR").length==1){nChangeEndTime=gArrObjChip[strChipId].displayEndDate-tEndTime;
if(nChangeEndTime!=0){gArrObjChip[strChipId].setScheEndDateTime(tEndTime);gArrObjChip[strChipId].setDisplayEndDate(tEndTime);rtChangedFlg=true}}}else if($("#"+C_MOVINGCHIPID+" .TimeKnobPointR").length==1){nChangeEndTime=gArrObjChip[strChipId].displayEndDate-tEndTime;if(nChangeEndTime!=0){gArrObjChip[strChipId].setPrmsEndDateTime(tEndTime);gArrObjChip[strChipId].setDisplayEndDate(tEndTime);rtChangedFlg=true}}nChangeStartTime=nChangeStartTime/60/1E3;nChangeEndTime=nChangeEndTime/60/1E3;var nOverDaysType=
GetChipOverDaysType(strChipId);var nScheWorkTime;if(nOverDaysType==C_OVERDAYS_NONE||$("#"+C_MOVINGCHIPID+" .TimeKnobPointL").length==1&&$("#"+C_MOVINGCHIPID+" .TimeKnobPointR").length==1)nScheWorkTime=(gArrObjChip[strChipId].displayEndDate-gArrObjChip[strChipId].displayStartDate)/60/1E3;else{nScheWorkTime=gArrObjChip[strChipId].scheWorkTime+nChangeStartTime-nChangeEndTime;if(nScheWorkTime<=gResizeInterval)nScheWorkTime=gResizeInterval}gArrObjChip[strChipId].setScheWorkTime(nScheWorkTime);return rtChangedFlg}
function ClickRezConFirmed(){var strChipId=gSelectedChipId;BackupRelationChips(strChipId);var arrRelationChips=FindRelationChips(strChipId,"");if(arrRelationChips.length==0){gArrObjChip[strChipId].setResvStatus(C_RTYPE_COMMITTED);gArrObjChip[strChipId].updateStallChip()}else for(var nLoop=0;nLoop<arrRelationChips.length;nLoop++)if(gArrObjChip[arrRelationChips[nLoop][0]]){gArrObjChip[arrRelationChips[nLoop][0]].setResvStatus(C_RTYPE_COMMITTED);gArrObjChip[arrRelationChips[nLoop][0]].updateStallChip()}SetTableUnSelectedStatus();
SetChipUnSelectedStatus();var jsonData={Method:"ClickRezConFirmed",SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};AddRowLockVersionOne(strChipId);DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}
function ClickCancelRezConFirmed(){var strChipId=gSelectedChipId;BackupRelationChips(strChipId);var arrRelationChips=FindRelationChips(strChipId,"");if(arrRelationChips.length==0){gArrObjChip[strChipId].setResvStatus(C_RTYPE_TEMP);gArrObjChip[strChipId].updateStallChip()}else for(var nLoop=0;nLoop<arrRelationChips.length;nLoop++)if(gArrObjChip[arrRelationChips[nLoop][0]]){gArrObjChip[arrRelationChips[nLoop][0]].setResvStatus(C_RTYPE_TEMP);gArrObjChip[arrRelationChips[nLoop][0]].updateStallChip()}SetTableUnSelectedStatus();
SetChipUnSelectedStatus();var jsonData={Method:"ClickCancelRezConFirmed",SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};AddRowLockVersionOne(strChipId);DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}
function ClickNoShow(){var rtValue=ConfirmSC3240101Msg(916);if(rtValue){var strChipId=gSelectedChipId;BackupRelationChips(strChipId);var dtNow=GetServerTimeNow();var arrDuplChipIds=GetDuplicateChips(strChipId);var arrRelationChips=FindRelationChips(strChipId,"");SetTableUnSelectedStatus(arrRelationChips);SetChipUnSelectedStatus();var jsonData={Method:"ClickBtnNoshow",SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};
AddRowLockVersionOne(strChipId);if(arrRelationChips.length==0)RemoveChipFromStall(strChipId);else for(var nLoop=0;nLoop<arrRelationChips.length;nLoop++)if(gArrObjChip[arrRelationChips[nLoop][0]])RemoveChipFromStall(arrRelationChips[nLoop][0]);SetLaterStallColorRed();DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}}
function ClickBtnStopJob(){var strChipId=gSelectedChipId;var dtEndNow;if(IsTodayPage()==false)dtEndNow=new Date($("#hidShowDate").val()+" "+$("#hidStallEndTime").val()+":00");else{dtEndNow=GetServerTimeNow();dtEndNow.setSeconds(0);dtEndNow.setMilliseconds(0)}var dtStart=gArrObjChip[strChipId].rsltStartDateTime;if($("#hidRestAutoJudgeFlg").val()!="1"){var nRowNo=GetRowNoByChipId(strChipId);var nLeft=GetXPosByTime(dtStart)+1;var nRight=GetXPosByTime(dtEndNow);$(".popStopWindowBase").data("RESTFLG",
C_RESTTIMEGETFLG_NOSET);var arrRestTimeId=GetRestTimeInRange(nRowNo,nLeft,nRight);if(arrRestTimeId.length>0){ShowRestTimeDialog(arrRestTimeId[0][0],C_ACTION_STOP);return}}var jsonData={Method:"HasBeforeStartJob",JobDtlId:gArrObjChip[strChipId].jobDtlId};gMainAreaActiveIndicator.show();DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}
function StopJobExceptBeforeJob(strStopReasonType,strStopMemo,nRestFlg){var strChipId=gSelectedChipId;BackupRelationChips(strChipId);var dtEndNow=GetServerTimeNow();dtEndNow.setSeconds(0);dtEndNow.setMilliseconds(0);gArrObjChip[strChipId].setStallUseStatus(C_STALLUSE_STATUS_STARTINCLUDESTOPJOB);$("#"+strChipId).addClass("StoppingJobColor");ShowDuplicateChips(strChipId);SetTableUnSelectedStatus();SetChipUnSelectedStatus();UpdateChipColorByDelayDate(strChipId);var jsonData;if(nRestFlg==null)jsonData=
{Method:"ClickBtnStopJob",ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,StallId:gArrObjChip[strChipId].stallId,StallUseId:gArrObjChip[strChipId].stallUseId,RsltStartDateTime:gArrObjChip[strChipId].rsltStartDateTime,RsltEndDateTime:dtEndNow,RowLockVersion:gArrObjChip[strChipId].rowLockVersion,StopTime:0,StopMemo:strStopMemo,StopReasonType:strStopReasonType};else jsonData={Method:"ClickBtnStopJob",ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,StallId:gArrObjChip[strChipId].stallId,
StallUseId:gArrObjChip[strChipId].stallUseId,RsltStartDateTime:gArrObjChip[strChipId].rsltStartDateTime,RsltEndDateTime:dtEndNow,RowLockVersion:gArrObjChip[strChipId].rowLockVersion,StopTime:0,StopMemo:strStopMemo,RestFlg:nRestFlg,StopReasonType:strStopReasonType};AddRowLockVersionOne(strChipId);DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}
function StopJob(strStopReasonType,nStopTime,strStopMemo,nRestFlg){var strChipId=gSelectedChipId;BackupRelationChips(strChipId);var dtEndNow;if(IsTodayPage()==false)dtEndNow=new Date($("#hidShowDate").val()+" "+$("#hidStallEndTime").val()+":00");else{dtEndNow=GetServerTimeNow();dtEndNow.setSeconds(0);dtEndNow.setMilliseconds(0)}var dtUnavailableStartTime,dtUnavailableEndTime;if(nStopTime>0){dtUnavailableStartTime=GetServerTimeNow();dtUnavailableStartTime.setMilliseconds(0);dtUnavailableStartTime.setSeconds(0);
var nMinutes=smbScript.RoundUpToNumUnits(dtUnavailableStartTime.getMinutes().toString(),gResizeInterval,0,60);if(nMinutes<60)dtUnavailableStartTime.setMinutes(nMinutes);else{dtUnavailableStartTime.setMinutes(0);dtUnavailableStartTime.setTime(dtUnavailableStartTime.getTime()+60*60*1E3)}dtUnavailableEndTime=new Date;dtUnavailableEndTime.setTime(dtUnavailableStartTime.getTime()+nStopTime*60*1E3);var nRowNo=GetRowNoByChipId(strChipId);var nLeft=GetXPosByTime(dtUnavailableStartTime)+1;var nRight=GetXPosByTime(dtUnavailableEndTime);
var arrRestTimeId=GetRestTimeInRange(nRowNo,nLeft,nRight);var arrDuplChipId=GetDuplChipIdInRange(nRowNo,nLeft,nRight);if(arrDuplChipId.length>0)if(arrDuplChipId.length!=1||arrDuplChipId[0][0]!=gSelectedChipId){ShowSC3240101Msg(914);return}var objUnvaliable=CreateUnavailableChip(C_UNAVALIABLENEWCHIPID,"");objUnvaliable.css({"left":nLeft,"width":nRight-nLeft});$(".Row"+nRowNo).append(objUnvaliable)}var dtBackDispEndDate=gArrObjChip[strChipId].DisplayEndDate;gArrObjChip[strChipId].setRsltEndDateTime(dtEndNow.toString());
gArrObjChip[strChipId].setDisplayDate();gArrObjChip[strChipId].setStallUseStatus(C_STALLUSE_STATUS_STOP);gArrObjChip[strChipId].updateStallChip();SetChipPosition(strChipId,"","","");$("#"+strChipId).removeClass("WorkingChipZIndex");ShowDuplicateChips(strChipId);SetTableUnSelectedStatus();SetChipUnSelectedStatus();UpdateChipColorByDelayDate(strChipId);var jsonData;if(nRestFlg==null)jsonData={Method:"ClickBtnStopJob",ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,StallId:gArrObjChip[strChipId].stallId,
StallUseId:gArrObjChip[strChipId].stallUseId,RsltStartDateTime:gArrObjChip[strChipId].rsltStartDateTime,RsltEndDateTime:gArrObjChip[strChipId].rsltEndDateTime,RowLockVersion:gArrObjChip[strChipId].rowLockVersion,StopTime:nStopTime,StopMemo:strStopMemo,StopReasonType:strStopReasonType};else jsonData={Method:"ClickBtnStopJob",ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,StallId:gArrObjChip[strChipId].stallId,StallUseId:gArrObjChip[strChipId].stallUseId,RsltStartDateTime:gArrObjChip[strChipId].rsltStartDateTime,
RsltEndDateTime:gArrObjChip[strChipId].rsltEndDateTime,RowLockVersion:gArrObjChip[strChipId].rowLockVersion,StopTime:nStopTime,StopMemo:strStopMemo,RestFlg:nRestFlg,StopReasonType:strStopReasonType};AddRowLockVersionOne(strChipId);DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}
function ClickBtnCarIn(){var strChipId=gSelectedChipId;BackupRelationChips(strChipId);var dtNow=GetServerTimeNow();var arrRelationChips=FindRelationChips(strChipId,"");if(arrRelationChips.length==0){gArrObjChip[strChipId].setRsltSvcInDateTime(dtNow);gArrObjChip[strChipId].updateStallChip()}else for(var nLoop=0;nLoop<arrRelationChips.length;nLoop++)if(gArrObjChip[arrRelationChips[nLoop][0]]){gArrObjChip[arrRelationChips[nLoop][0]].setRsltSvcInDateTime(dtNow);gArrObjChip[arrRelationChips[nLoop][0]].updateStallChip()}SetTableUnSelectedStatus();
SetChipUnSelectedStatus();var jsonData={Method:"ClickBtnCarIn",SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,RsltServiceInDate:gArrObjChip[strChipId].rsltSvcInDateTime,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};AddRowLockVersionOne(strChipId);DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}
function ClickBtnCancelCarIn(){var strChipId=gSelectedChipId;BackupRelationChips(strChipId);var arrRelationChips=FindRelationChips(strChipId,"");if(arrRelationChips.length==0){gArrObjChip[strChipId].setRsltSvcInDateTime(new Date(C_DATE_DEFAULT_VALUE));gArrObjChip[strChipId].updateStallChip()}else for(var nLoop=0;nLoop<arrRelationChips.length;nLoop++)if(gArrObjChip[arrRelationChips[nLoop][0]]){gArrObjChip[arrRelationChips[nLoop][0]].setRsltSvcInDateTime(new Date(C_DATE_DEFAULT_VALUE));gArrObjChip[arrRelationChips[nLoop][0]].updateStallChip()}SetTableUnSelectedStatus();
SetChipUnSelectedStatus();var jsonData={Method:"ClickBtnCancelCarIn",SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};AddRowLockVersionOne(strChipId);DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}
function ClickBtnStart(){var strChipId=gSelectedChipId;var bStartChipFlg=false;$("#"+strChipId).offsetParent().children("div").each(function(index,e){if(gArrObjChip[e.id])if(IsDefaultDate(gArrObjChip[e.id].rsltStartDateTime)==false&&IsDefaultDate(gArrObjChip[e.id].rsltEndDateTime)==true)bStartChipFlg=true});if(bStartChipFlg){ShowSC3240101Msg(905);return}var dtStartNow=GetServerTimeNow();dtStartNow.setSeconds(0);dtStartNow.setMilliseconds(0);if(IsRelationChip(strChipId)==true)if(HasWorkingChipInRelation(strChipId)){var stallId=
GetStallIdOfRelationChip(strChipId);if(stallId!=undefined){ShowSC3240101Msg(937,stallId);return}ShowSC3240101Msg(910);return}var nRowNo=GetRowNoByChipId(strChipId);if($("#"+strChipId+" .infoBox")[0].innerHTML.toString().Trim()==""){ShowSC3240101Msg(904);return}if($("#hidRestAutoJudgeFlg").val()!="1"){var nLeft=GetXPosByTime(dtStartNow)+1;var nRight=nLeft+$("#"+strChipId).width();var arrRestTimeId=GetRestTimeInRange(nRowNo,nLeft,nRight);if(arrRestTimeId.length>0){ShowRestTimeDialog(arrRestTimeId[0][0],
C_ACTION_START);return}}StartChip(null)}
function StartChip(nRestFlg){var strChipId=gSelectedChipId;var dtStartNow=GetServerTimeNow();dtStartNow.setSeconds(0);dtStartNow.setMilliseconds(0);var dtTapDateTime=new Date;dtTapDateTime.setTime(dtStartNow.getTime());var nLeft=GetXPosByTime(dtStartNow)+1;var nWidth=$("#"+C_MOVINGCHIPID).width();var nRestTimeWidth=0;if($("#hidRestAutoJudgeFlg").val()!="1"){if(nRestFlg!=null)if(nRestFlg==1){$("#"+C_MOVINGCHIPID).css({"left":nLeft,"width":nWidth});var arrRestTime=GetRestTimeInServiceTime(C_MOVINGCHIPID);
var nChipLeft=GetLeftByRestTime(C_MOVINGCHIPID,arrRestTime);if(nChipLeft!=nLeft){nLeft=nChipLeft;$("#"+C_MOVINGCHIPID).css("left",nLeft)}nRestTimeWidth=GetWidthByRestTime(C_MOVINGCHIPID)}}else{$("#"+C_MOVINGCHIPID).css({"left":nLeft,"width":nWidth});nRestTimeWidth=GetWidthByRestTime(C_MOVINGCHIPID)}dtEndTime=GetTimeByXPos(nLeft+nWidth+nRestTimeWidth);BackupRelationChips(strChipId);gArrObjChip[strChipId].setRsltStartDateTime(dtTapDateTime.toString());if(IsRelationChip(strChipId)==true)gArrObjRelationChip[strChipId].setStartDateTime(dtTapDateTime);
gArrObjChip[strChipId].setDisplayStartDate(dtTapDateTime.toString());gArrObjChip[strChipId].setDisplayEndDate(dtEndTime.toString());gArrObjChip[strChipId].updateStallChip();SetChipPosition(strChipId,"","","");ShowDuplicateChips(strChipId);SetTableUnSelectedStatus();SetChipUnSelectedStatus();var nMinutes=Math.ceil((gArrObjChip[strChipId].displayEndDate-gArrObjChip[strChipId].displayStartDate)/1E3/60);UpdateChipColorByDelayDate(strChipId);var jsonData;if(nRestFlg==null)jsonData={Method:"ClickBtnStart",
ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,JobDtlId:gArrObjChip[strChipId].jobDtlId,ReStartJobFlg:C_RESTARTJOB_NOTSET,StallUseId:gArrObjChip[strChipId].stallUseId,StallId:gArrObjChip[strChipId].stallId,RsltStartDateTime:dtTapDateTime,ScheWorkTime:gArrObjChip[strChipId].scheWorkTime,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};else jsonData={Method:"ClickBtnStart",ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,JobDtlId:gArrObjChip[strChipId].jobDtlId,
ReStartJobFlg:C_RESTARTJOB_NOTSET,StallUseId:gArrObjChip[strChipId].stallUseId,StallId:gArrObjChip[strChipId].stallId,RsltStartDateTime:dtTapDateTime,ScheWorkTime:gArrObjChip[strChipId].scheWorkTime,RestFlg:nRestFlg,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};gBackupStartJson[gArrObjChip[strChipId].stallUseId]=jsonData;$("#"+strChipId).data(C_DATA_CHIPTAP_FLG,false);AddRowLockVersionOne(strChipId);DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}
function ClickBtnFinish(){var strChipId=gSelectedChipId;var dtEndNow;if(IsTodayPage()==false)dtEndNow=gEndWorkTime;else dtEndNow=GetServerTimeNow();dtEndNow.setSeconds(0);dtEndNow.setMilliseconds(0);if($("#hidRestAutoJudgeFlg").val()!="1"){var nRowNo=GetRowNoByChipId(strChipId);var nLeft=$("#"+strChipId).position().left;var nRight=GetXPosByTime(dtEndNow);var arrRestTimeId=GetRestTimeInRange(nRowNo,nLeft,nRight);if(arrRestTimeId.length>0){ShowRestTimeDialog(arrRestTimeId[0][0],C_ACTION_FINISH);return}}FinishChip(null)}
function FinishChip(nRestFlg){var strChipId=gSelectedChipId;if(C_STALLUSE_STATUS_STARTINCLUDESTOPJOB==gArrObjChip[strChipId].stallUseStatus){var retConfirm=ConfirmSC3240101Msg(930);if(!retConfirm)return}BackupRelationChips(strChipId);var dtEndNow;if(IsTodayPage()==false)dtEndNow=gEndWorkTime;else dtEndNow=GetServerTimeNow();dtEndNow.setSeconds(0);dtEndNow.setMilliseconds(0);gArrObjChip[strChipId].setRsltEndDateTime(dtEndNow.toString());gArrObjChip[strChipId].setDisplayDate();gArrObjChip[strChipId].updateStallChip();
SetChipPosition(strChipId,"","","");$("#"+strChipId).removeClass("WorkingChipZIndex");$("#"+strChipId).removeClass("StoppingJobColor");ShowDuplicateChips(strChipId);SetTableUnSelectedStatus();SetChipUnSelectedStatus();UpdateChipColorByDelayDate(strChipId);var jsonData;if(nRestFlg==null)jsonData={Method:"ClickBtnFinish",ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,StallId:gArrObjChip[strChipId].stallId,RsltStartDateTime:gArrObjChip[strChipId].rsltStartDateTime,
RsltEndDateTime:gArrObjChip[strChipId].rsltEndDateTime,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};else jsonData={Method:"ClickBtnFinish",ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,StallId:gArrObjChip[strChipId].stallId,RsltStartDateTime:gArrObjChip[strChipId].rsltStartDateTime,RsltEndDateTime:gArrObjChip[strChipId].rsltEndDateTime,RestFlg:nRestFlg,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};AddRowLockVersionOne(strChipId);
DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}
function ClickMidFinish(){var strChipId=gSelectedChipId;BackupRelationChips(strChipId);var dtEndNow;if(IsTodayPage()==false)dtEndNow=gEndWorkTime;else dtEndNow=GetServerTimeNow();dtEndNow.setSeconds(0);dtEndNow.setMilliseconds(0);if($("#hidRestAutoJudgeFlg").val()!="1"){var nRowNo=GetRowNoByChipId(strChipId);var nLeft=$("#"+strChipId).position().left;var nRight=GetXPosByTime(dtEndNow);var arrRestTimeId=GetRestTimeInRange(nRowNo,nLeft,nRight);if(arrRestTimeId.length>0){ShowRestTimeDialog(arrRestTimeId[0][0],
C_ACTION_MIDFINISH);return}}MidfinishChip(null)}
function MidfinishChip(nRestFlg){var strChipId=gSelectedChipId;var dtEndNow;if(IsTodayPage()==false)dtEndNow=gEndWorkTime;else dtEndNow=GetServerTimeNow();dtEndNow.setSeconds(0);dtEndNow.setMilliseconds(0);gArrObjChip[strChipId].setRsltEndDateTime(dtEndNow.toString());gArrObjChip[strChipId].setDisplayDate();gArrObjChip[strChipId].updateStallChip();SetChipPosition(strChipId,"","","");$("#"+strChipId).removeClass("WorkingChipZIndex");ShowDuplicateChips(strChipId);SetTableUnSelectedStatus();SetChipUnSelectedStatus();
UpdateChipColorByDelayDate(strChipId);$("#"+strChipId).removeClass("StoppingJobColor");var jsonData;if(nRestFlg==null)jsonData={Method:"ClickMidFinish",ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,StallId:gArrObjChip[strChipId].stallId,RsltStartDateTime:gArrObjChip[strChipId].rsltStartDateTime,RsltEndDateTime:gArrObjChip[strChipId].rsltEndDateTime,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};else jsonData={Method:"ClickMidFinish",
ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,StallId:gArrObjChip[strChipId].stallId,RsltStartDateTime:gArrObjChip[strChipId].rsltStartDateTime,RsltEndDateTime:gArrObjChip[strChipId].rsltEndDateTime,RestFlg:nRestFlg,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}
function ClickCopy(){var strChipId=gSelectedChipId;SetChipUnSelectedStatus();SetTableUnSelectedStatus();gCopyChipObj=new ReserveChip(C_COPYCHIPID);if(gArrObjChip[strChipId])gArrObjChip[strChipId].copy(gCopyChipObj);else if(gArrObjSubChip[strChipId]){gArrObjSubChip[strChipId].copy(gCopyChipObj);if(gArrObjSubChip[strChipId].subChipAreaId==C_RECEPTION)gCopyChipObj.setPartsFlg("0")}else return;gCopyChipObj.setStallUseId(C_COPYCHIPID);gCopyChipObj.setRsltStartDateTime(C_DATE_DEFAULT_VALUE);gCopyChipObj.setPrmsEndDateTime(C_DATE_DEFAULT_VALUE);
gCopyChipObj.setRsltEndDateTime(C_DATE_DEFAULT_VALUE);gCopyChipObj.setCwRsltStartDateTime(C_DATE_DEFAULT_VALUE);gCopyChipObj.setCwRsltEndDateTime(C_DATE_DEFAULT_VALUE);gCopyChipObj.setScheWorkTime(45);gCopyChipObj.setUpperDisp(" ");gCopyChipObj.setLowerDisp(" ");gCopyChipObj.setSvcClassName(" ");gCopyChipObj.setSvcClassNameEng(" ");gCopyChipObj.createChip(C_CHIPTYPE_COPY);$("#"+C_COPYCHIPID).css("top",$(".stallNo1").position().top+2+"px").css("left","7px").css("width","130px").css("height","70px").css("opacity",
C_OPACITY_TRANSPARENT);AdjustChipItemByWidth(C_COPYCHIPID);$(".ChipArea_trimming").SmbFingerScroll({action:"move",moveY:$(".scroll-inner").position().top,moveX:0});gSelectedChipId=C_COPYCHIPID;$("#"+C_COPYCHIPID).unbind().bind("chipTap",function(e){SetChipUnSelectedStatus();SetTableUnSelectedStatus()});SetTableSelectedStatus();setRedTimeLineLeftPos(false);if(IsDefaultDate(gCopyChipObj.scheDeliDateTime)==false){var dtScheDeliLater=GetDeliDelayExpectedTimeLine(gCopyChipObj.carWashNeedFlg,gCopyChipObj.scheDeliDateTime,
gCopyChipObj.svcStatus,gCopyChipObj.remainingInspectionType);var setPosition=GetTimeLinePosByTime(dtScheDeliLater);$(".TimingLineDeli").css("left",setPosition);$(".TimingLineDeli").css("visibility","visible")}SetSubChipBoxClose();CreateFooterButton(C_FT_DISPTP_SELECTED,C_FT_BTNTP_COPYCHIP)}function DeleteCopyedChip(){var rtValue=ConfirmSC3240101Msg(913);if(rtValue){SetTableUnSelectedStatus();SetChipUnSelectedStatus()}}
function HasChiphistory(strChipId){var bReturn=false;if(IsKariKariChip(strChipId))return bReturn;if(gArrObjChip[strChipId])if(IsDefaultDate(gArrObjChip[strChipId].chiphisScheStartDateTime)==false&&IsDefaultDate(gArrObjChip[strChipId].chiphisScheEndDateTime)==false&&gArrObjChip[strChipId].chiphisStallId!="")bReturn=true;return bReturn}
function UndoMainStallChip(){var strChipId=gSelectedChipId;if(!HasChiphistory(strChipId)){$("#"+gSelectedChipId).data(C_DATA_CHIPTAP_FLG,false);SetTableUnSelectedStatus();SetChipUnSelectedStatus();jsonData={Method:"UndoMainStallChip",StallUseId:gArrObjChip[strChipId].stallUseId,SvcInId:gArrObjChip[strChipId].svcInId,StallId:gArrObjChip[strChipId].stallId,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};AddRowLockVersionOne(strChipId);DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,
jsonData.Method);return}gArrObjChip[strChipId].setScheStartDateTime(gArrObjChip[strChipId].chiphisScheStartDateTime);gArrObjChip[strChipId].setScheEndDateTime(gArrObjChip[strChipId].chiphisScheEndDateTime);gArrObjChip[strChipId].setScheWorkTime(gArrObjChip[strChipId].chiphisScheWorktime);gArrObjChip[strChipId].setDisplayStartDate(gArrObjChip[strChipId].chiphisScheStartDateTime);gArrObjChip[strChipId].setDisplayEndDate(gArrObjChip[strChipId].chiphisScheEndDateTime);gArrObjChip[strChipId].setStallId(gArrObjChip[strChipId].chiphisStallId);
if(gArrObjRelationChip[strChipId])gArrObjRelationChip[strChipId].setStartDateTime(gArrObjChip[strChipId].chiphisScheStartDateTime);var arrRelationChips=FindRelationChips(strChipId,"");if(arrRelationChips.length==0){gArrObjChip[strChipId].setSvcStatus(gArrObjChip[strChipId].chiphisSvcStatus);gArrObjChip[strChipId].setResvStatus(gArrObjChip[strChipId].chiphisResvStatus)}else for(var nLoop=0;nLoop<arrRelationChips.length;nLoop++)if(gArrObjChip[arrRelationChips[nLoop][0]]){gArrObjChip[arrRelationChips[nLoop][0]].setSvcStatus(gArrObjChip[strChipId].chiphisSvcStatus);
gArrObjChip[arrRelationChips[nLoop][0]].setResvStatus(gArrObjChip[strChipId].chiphisResvStatus)}var bIsWorkOrderWait=gArrObjChip[strChipId].svcStatus==C_SVCSTATUS_WORKORDERWAIT;var bIsStartWait=gArrObjChip[strChipId].svcStatus==C_SVCSTATUS_STARTWAIT;if(bIsWorkOrderWait||bIsStartWait){var strStallUseStatus=bIsWorkOrderWait?C_STALLUSE_STATUS_WORKORDERWAIT:C_STALLUSE_STATUS_STARTWAIT;gArrObjChip[strChipId].setStallUseStatus()}gArrObjChip[strChipId].setRsltStartDateTime(C_DATE_DEFAULT_VALUE);gArrObjChip[strChipId].setPrmsEndDateTime(C_DATE_DEFAULT_VALUE);
gArrObjChip[strChipId].clearWorkingChipHisInfo();if(arrRelationChips.length==0)gArrObjChip[strChipId].updateStallChip();else for(var nLoop=0;nLoop<arrRelationChips.length;nLoop++)if(gArrObjChip[arrRelationChips[nLoop][0]])gArrObjChip[arrRelationChips[nLoop][0]].updateStallChip();SetChipPosition(strChipId,"","","");if($("#hidRestAutoJudgeFlg").val()=="1")$("#"+gSelectedChipId).data(C_DATA_CHIPTAP_FLG,false);SetTableUnSelectedStatus();SetChipUnSelectedStatus();jsonData={Method:"UndoMainStallChip",StallUseId:gArrObjChip[strChipId].stallUseId,
SvcInId:gArrObjChip[strChipId].svcInId,StallId:gArrObjChip[strChipId].stallId,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};AddRowLockVersionOne(strChipId);DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}
function ClickToReception(){var rtValue=ConfirmSC3240101Msg(938);if(rtValue){var jsonData;var strChipId=gSelectedChipId;BackupRelationChips(strChipId);AddRowLockVersionOne(strChipId);SetTableUnSelectedStatus();SetChipUnSelectedStatus();var nBackMinutes=Math.ceil((gArrObjChip[strChipId].displayEndDate-gArrObjChip[strChipId].displayStartDate)/1E3/60);jsonData={Method:"ClickBtnToReception",SvcinId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,StallId:gArrObjChip[strChipId].stallId,
JobDtlId:gArrObjChip[strChipId].jobDtlId,StaffId:gArrObjChip[strChipId].StaffId,FunctionId:gArrObjChip[strChipId].FunctionId,RowLockVersion:gArrObjChip[strChipId].rowLockVersion-1};RemoveChipFromStall(strChipId);if(gArrBackChipObj[0].delayStatus!=C_NO_DELAY)SetLaterStallColorRed();DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}return}
function ClickBtnNoRest(){var strChipId=gSelectedChipId;var nOverDaysType=GetChipOverDaysType(strChipId);if(C_OVERDAYS_NONE<nOverDaysType)$("#"+gSelectedChipId).data(C_DATA_CHIPTAP_FLG,false);else $("#"+strChipId).css("width",gArrObjChip[strChipId].scheWorkTime*C_CELL_WIDTH/15-1);gArrObjChip[strChipId].restFlg=C_RESTTIMEGETFLG_NOGETREST;SetTableUnSelectedStatus();SetChipUnSelectedStatus();var jsonData={Method:"ClickBtnNoRest",ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,
StallUseId:gArrObjChip[strChipId].stallUseId,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};AddRowLockVersionOne(strChipId);DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}
function ClickBtnRest(){var strChipId=gSelectedChipId;var nOverDaysType=GetChipOverDaysType(strChipId);if(C_OVERDAYS_NONE<nOverDaysType)$("#"+gSelectedChipId).data(C_DATA_CHIPTAP_FLG,false);else{nRestTimeWidth=GetWidthByRestTime(strChipId);$("#"+strChipId).css("width",$("#"+strChipId).width()+nRestTimeWidth)}gArrObjChip[strChipId].restFlg=C_RESTTIMEGETFLG_GETREST;var nTapTime=GetTimeByXPos($("#"+strChipId).position().left);SetTableUnSelectedStatus();SetChipUnSelectedStatus();var jsonData={Method:"ClickBtnRest",
ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};AddRowLockVersionOne(strChipId);DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}
function ClickBtnDel(){var rtValue=ConfirmSC3240101Msg(913);if(rtValue){var jsonData;var strChipId=gSelectedChipId;if(strChipId==C_NEWCHIPID){SetTableUnSelectedStatus();SetChipUnSelectedStatus();return}var arrDuplChipIds=GetDuplicateChips(strChipId);if(IsUnavailableArea(strChipId)){SetTableUnSelectedStatus();SetChipUnSelectedStatus();var strRowLockVersion=$("#"+strChipId).data("ROW_LOCK_VERSION");$("#"+strChipId).remove();jsonData={Method:"ClickBtnDeleteStallUnavailable",StallIdleId:right(strChipId,
strChipId.length-C_UNAVALIABLECHIPID.length),RowLockVersion:strRowLockVersion};DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method);return}BackupRelationChips(strChipId);AddRowLockVersionOne(strChipId);DeleteChipFromRelationChipObj(strChipId);SetTableUnSelectedStatus();SetChipUnSelectedStatus();var nBackMinutes=Math.ceil((gArrObjChip[strChipId].displayEndDate-gArrObjChip[strChipId].displayStartDate)/1E3/60);jsonData={Method:"ClickBtnDeleteStallChip",ShowDate:$("#hidShowDate").val(),
SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,RowLockVersion:gArrObjChip[strChipId].rowLockVersion-1};RemoveChipFromStall(strChipId);if(gArrBackChipObj[0].delayStatus!=C_NO_DELAY)SetLaterStallColorRed();DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}}
function RemoveChipFromStall(strChipId){var arrDuplChipIds=GetDuplicateChips(strChipId);$("#"+strChipId).remove();gArrObjChip[strChipId]=null;DeleteWhiteBoarder(arrDuplChipIds,strChipId)}function DeleteChipFromRelationChipObj(strChipId){var arrRelationChipId=FindRelationChips(strChipId,"");if(IsRelationChip(strChipId)==true)if(arrRelationChipId.length==2){gArrObjRelationChip[arrRelationChipId[0][0]]=null;gArrObjRelationChip[arrRelationChipId[1][0]]=null}else gArrObjRelationChip[strChipId]=null}
function ShowDuplicateChips(strChipId){if(gWBChipId!=""){$("#"+gWBChipId).remove();if(strChipId!="")$("#"+strChipId).removeClass("SelectedChipZIndex");strChipId=gWBChipId.substring(2,gWBChipId.length);gWBChipId=""}return CreateWhiteBorders(strChipId)}function RemovePopUpBox(){$(".PopUpChipBoxBorder").remove();gPopupBoxId="";gCancelFlg=true;setTimeout(function(){gCancelFlg=false},500)}
function GetDuplicateChips(strChipId){var arrDuplChipId=new Array;if(!gArrObjChip[strChipId])return arrDuplChipId;var nMovingChipLeft=$("#"+strChipId).position().left;var nMovingChipRight=nMovingChipLeft+$("#"+strChipId).width();var objWorkingChip;var arrOverWordChip=new Array;var nLoop=0;var nLoopOverWork=0;var arrTemp=new Array;$("#"+strChipId).offsetParent().children("div").each(function(index,e){if(e.id!=C_MOVINGCHIPID&&!IsUnavailableArea(e.id)&&!IsRestArea(e.id)&&e.id!=""&&!IsKariKariChip(e.id)){var nChipLeft=
e.offsetLeft;var nChipRight=e.offsetLeft+e.offsetWidth;if(!(nChipRight<nMovingChipLeft||nChipLeft>nMovingChipRight)&&left(e.id.toString(),2)!="WB"&&gArrObjChip[e.id])if(IsDefaultDate(gArrObjChip[e.id].rsltStartDateTime)==false&&IsDefaultDate(gArrObjChip[e.id].rsltEndDateTime)==true){if(IsDefaultDate(gArrObjChip[strChipId].rsltEndDateTime)||strChipId==e.id)objWorkingChip=new Array(e.id,nChipLeft)}else if(IsDefaultDate(gArrObjChip[e.id].rsltEndDateTime)==false){if(IsDefaultDate(gArrObjChip[strChipId].rsltStartDateTime)||
strChipId==e.id){arrOverWordChip[nLoopOverWork]=new Array(e.id,nChipLeft);nLoopOverWork++}}else{arrTemp[nLoop]=new Array(e.id,nChipLeft);nLoop++}}});if(objWorkingChip!=null)arrDuplChipId[0]=objWorkingChip;if(arrTemp.length>0){arrTemp.sort(function(x,y){return x[1]-y[1]});arrDuplChipId=arrDuplChipId.concat(arrTemp)}if(arrOverWordChip.length>0){arrOverWordChip.sort(function(x,y){return x[1]-y[1]});arrDuplChipId=arrDuplChipId.concat(arrOverWordChip)}return arrDuplChipId}
function GetMovingCpDuplicateChips(){var nMovingChipLeft=$("#"+C_MOVINGCHIPID).position().left;var nMovingChipRight=nMovingChipLeft+$("#"+C_MOVINGCHIPID).width();var nLoop=0;var arrDuplChipId=new Array;var compareChipId;var bWorkingChipFlg=false;if(gArrObjChip[gSelectedChipId]){if(IsDefaultDate(gArrObjChip[gSelectedChipId].rsltStartDateTime)==false&&IsDefaultDate(gArrObjChip[gSelectedChipId].rsltEndDateTime))bWorkingChipFlg=true;compareChipId=gSelectedChipId}else if(gArrObjSubChip[gSelectedChipId])compareChipId=
gArrObjSubChip[gSelectedChipId].stallUseId;$("#"+C_MOVINGCHIPID).offsetParent().children("div").each(function(index,e){if(e.id!=compareChipId&&e.id!=C_MOVINGCHIPID&&!IsUnavailableArea(e.id)&&!IsRestArea(e.id))if(gArrObjChip[e.id]){if(!(IsDefaultDate(gArrObjChip[e.id].rsltEndDateTime)==false&&bWorkingChipFlg)){var nChipLeft=e.offsetLeft;var nChipRight=e.offsetLeft+e.offsetWidth;if(!(nChipRight<nMovingChipLeft||nChipLeft>nMovingChipRight)&&left(e.id.toString(),2)!="WB"){arrDuplChipId[nLoop]=e.id;nLoop++}}}else{var nChipLeft=
e.offsetLeft;var nChipRight=e.offsetLeft+e.offsetWidth;if(!(nChipRight<nMovingChipLeft||nChipLeft>nMovingChipRight)&&left(e.id.toString(),2)!="WB"){arrDuplChipId[nLoop]=e.id;nLoop++}}});return arrDuplChipId}
function GetUnavaliableMovingCpDuplicateChips(){var nMovingChipLeft=$("#"+C_MOVINGUNAVALIABLECHIPID).position().left;var nMovingChipRight=nMovingChipLeft+$("#"+C_MOVINGUNAVALIABLECHIPID).width();var nLoop=0;var arrDuplChipId=new Array;$("#"+C_MOVINGUNAVALIABLECHIPID).offsetParent().children("div").each(function(index,e){if(e.id!=gSelectedChipId&&e.id!=C_MOVINGUNAVALIABLECHIPID&&!IsUnavailableArea(e.id)&&!IsRestArea(e.id)){var nChipLeft=e.offsetLeft;var nChipRight=e.offsetLeft+e.offsetWidth;if(!(nChipRight<
nMovingChipLeft||nChipLeft>nMovingChipRight)&&left(e.id.toString(),2)!="WB"){arrDuplChipId[nLoop]=e.id;nLoop++}}});return arrDuplChipId}
function CreateWhiteBorders(strChipId){var arrDuplChipId=GetDuplicateChips(strChipId);if(arrDuplChipId.length==1)return;var arrDuplicateChipsId=new Array;for(var nLoop=0;nLoop<arrDuplChipId.length;nLoop++)if(IsDefaultDate(gArrObjChip[arrDuplChipId[nLoop][0]].rsltStartDateTime)==false&&IsDefaultDate(gArrObjChip[arrDuplChipId[nLoop][0]].rsltEndDateTime)==true||IsDefaultDate(gArrObjChip[arrDuplChipId[nLoop][0]].rsltEndDateTime)==false)arrDuplicateChipsId.push(arrDuplChipId[nLoop][0]);for(var nWorkLoop=
0;nWorkLoop<arrDuplicateChipsId.length;nWorkLoop++){arrDuplChipId=new Array;arrDuplChipId=GetDuplicateChips(arrDuplicateChipsId[nWorkLoop]);if(arrDuplChipId.length>1)for(var nLoop=0;nLoop<arrDuplChipId.length;nLoop++){if(IsDefaultDate(gArrObjChip[arrDuplChipId[arrDuplChipId.length-1][0]].rsltEndDateTime)==false)if(nLoop==arrDuplChipId.length-1)ChangeChipZIndex(arrDuplChipId[arrDuplChipId.length-1][0],"WorkOverChipZIndex");else if(!(IsDefaultDate(gArrObjChip[arrDuplChipId[0][0]].rsltStartDateTime)==
false&&IsDefaultDate(gArrObjChip[arrDuplChipId[0][0]].rsltEndDateTime)==true)){CreateWhiteBorder(arrDuplChipId[nLoop][0]);var arrRezDuplChip=GetDuplicateChips(arrDuplChipId[nLoop][0]);var arrDuplOverChip=new Array;for(var i=0;i<arrRezDuplChip.length;i++)arrDuplOverChip[i]=new Array(arrRezDuplChip[i][0],1);BindWhiteBorderTapEvent(arrDuplOverChip[0][0],arrDuplOverChip);ChangeChipZIndex(arrDuplChipId[nLoop][0],"WorkRezChipZIndex")}if(IsDefaultDate(gArrObjChip[arrDuplChipId[0][0]].rsltStartDateTime)==
false&&IsDefaultDate(gArrObjChip[arrDuplChipId[0][0]].rsltEndDateTime)==true)if(nLoop==0){CreateWhiteBorder(arrDuplChipId[0][0]);if(IsDefaultDate(gArrObjChip[arrDuplChipId[arrDuplChipId.length-1][0]].rsltEndDateTime)==false){var arrDuplWorkingChip=new Array;for(var i=0;i<arrDuplChipId.length-1;i++)arrDuplWorkingChip[i]=new Array(arrDuplChipId[i][0],1);BindWhiteBorderTapEvent(arrDuplChipId[0][0],arrDuplWorkingChip)}else BindWhiteBorderTapEvent(arrDuplChipId[0][0],arrDuplChipId);ChangeChipZIndex(arrDuplChipId[0][0],
"WorkingChipZIndex")}else ChangeChipZIndex(arrDuplChipId[nLoop][0],"WorkRezChipZIndex")}}}
function CreateWhiteBorder(strChipId){$("#WB"+strChipId).remove();var nMovingChipLeft=$("#"+strChipId).position().left;var nMovingChipRight=nMovingChipLeft+$("#"+strChipId).width();var strClassZIndex="";if(IsDefaultDate(gArrObjChip[strChipId].rsltStartDateTime)==false&&IsDefaultDate(gArrObjChip[strChipId].rsltEndDateTime)==true)strClassZIndex=" WorkingChipZIndex";else if(IsDefaultDate(gArrObjChip[strChipId].rsltStartDateTime)==true)strClassZIndex=" WorkRezChipZIndex";var objWhiteBorder=$("<div />").addClass("WhiteBorder selection"+
strClassZIndex).append("<p></p>");objWhiteBorder.attr("id","WB"+strChipId);var nRowNo=GetRowNoByChipId(strChipId);$(".Row"+nRowNo).append(objWhiteBorder);$("#WB"+strChipId).css("left",nMovingChipLeft);$("#WB"+strChipId).css("width",nMovingChipRight-nMovingChipLeft)}
function BindWhiteBorderTapEvent(strChipId,arrDuplChipId){$("#WB"+strChipId).unbind();$("#WB"+strChipId).bind("chipTap",function(e){if(gSelectedChipId)return false;var nDisplayWnd=GetDisplayPopupWindow();if(nDisplayWnd>C_DISP_NONE){if(nDisplayWnd==C_DISP_DUPL)RemovePopUpBox();return}if(gCancelFlg)return;var bReceptionChipFlg=false;if(gArrObjSubChip[gSelectedChipId])if(gArrObjSubChip[gSelectedChipId].subChipAreaId==C_RECEPTION)bReceptionChipFlg=true;if(!bReceptionChipFlg){SetSubChipBoxClose();CreateFooterButton(C_FT_DISPTP_UNSELECTED,
0);SetChipUnSelectedStatus();SetTableUnSelectedStatus()}if(gShowLaterStallFlg==true)ShowAllStall();if(gPopupBoxId!=""){var strPopupBoxId=gPopupBoxId;if(strPopupBoxId!="POPUPBOX_"+strChipId)CreatePopUpChipBox(strChipId,arrDuplChipId)}else CreatePopUpChipBox(strChipId,arrDuplChipId);return false})}
function ChangeChipZIndex(strChipId,strZIndex){if($("#"+strChipId).hasClass("SelectedChipZIndex"))$("#"+strChipId).removeClass("SelectedChipZIndex");if($("#"+strChipId).hasClass("SelectedRelationWorkingChipZIndex"))$("#"+strChipId).removeClass("SelectedRelationWorkingChipZIndex");if($("#"+strChipId).hasClass("SelectedRelationWorkOverChipZIndex"))$("#"+strChipId).removeClass("SelectedRelationWorkOverChipZIndex");if($("#"+strChipId).hasClass("SelectedRelationRezChipZIndex"))$("#"+strChipId).removeClass("SelectedRelationRezChipZIndex");
if($("#"+strChipId).hasClass("MovingChipZIndex"))$("#"+strChipId).removeClass("MovingChipZIndex");if($("#"+strChipId).hasClass("WorkOverChipZIndex"))$("#"+strChipId).removeClass("WorkOverChipZIndex");if($("#"+strChipId).hasClass("WorkRezChipZIndex"))$("#"+strChipId).removeClass("WorkRezChipZIndex");if($("#"+strChipId).hasClass("WorkingChipZIndex"))$("#"+strChipId).removeClass("WorkingChipZIndex");if(strZIndex!="")$("#"+strChipId).addClass(strZIndex)}
function SetDefaultZIndex(strChipId){var arrDuplChipId=GetDuplicateChips(strChipId);if(arrDuplChipId.length>1)for(var nLoop=0;nLoop<arrDuplChipId.length;nLoop++)if(IsDefaultDate(gArrObjChip[arrDuplChipId[nLoop][0]].rsltEndDateTime)==false)ChangeChipZIndex(arrDuplChipId[nLoop][0],"WorkOverChipZIndex");else if(IsDefaultDate(gArrObjChip[arrDuplChipId[nLoop][0]].rsltStartDateTime)==false&&IsDefaultDate(gArrObjChip[arrDuplChipId[nLoop][0]].rsltEndDateTime)==true)ChangeChipZIndex(strChipId,"WorkingChipZIndex");
else ChangeChipZIndex(arrDuplChipId[nLoop][0],"WorkRezChipZIndex")}
function CreatePopUpChipBox(strChipId,arrDuplChipId){gPopupBoxId="POPUPBOX_"+strChipId;gWBChipId="WB"+strChipId;var objPopUpChipBoxBorder=$("<div />").addClass("PopUpChipBoxBorder");var objTriangleBorder=$("<div />").addClass("TriangleBorderDown");var objPopUpChipBox=$("<div />").addClass("PopUpChipBox");var objPopUpScrollBox=$("<div />").addClass("PopUpScrollBox");var objPopUpChipInnerBox=$("<div />").addClass("PopUpChipInnerBox");objPopUpChipBoxBorder.append(objTriangleBorder);objPopUpChipBoxBorder.append(objPopUpChipBox);
objPopUpChipBox.append(objPopUpScrollBox);objPopUpScrollBox.append(objPopUpChipInnerBox);$("#MainArea").append(objPopUpChipBoxBorder);var nWidth,nTop,nLeft;if(arrDuplChipId.length>C_POPUP_MAX_CHIP_NUM)nWidth=C_POPUP_MAX_CHIP_NUM;else nWidth=arrDuplChipId.length;nWidth=(nWidth+1)*10+nWidth*(C_CELL_WIDTH*2-1);$(".PopUpChipBoxBorder").css("width",nWidth);$(".PopUpChipBox").css("width",nWidth-2);$(".PopUpScrollBox").css("width",nWidth-2);var nScrollWidth=arrDuplChipId.length;nScrollWidth=(nScrollWidth+
1)*10+nScrollWidth*(C_CELL_WIDTH*2-1);$(".PopUpChipInnerBox").css("width",nScrollWidth-2);var nRowNo=GetRowNoByChipId(arrDuplChipId[0][0]);var strTriangleBorder="TriangleBorderDown";var offset;var nTop;if(nRowNo-2>0){nRowNo-=2;nTop=$(".Row"+nRowNo).position().top+42+18+C_CHIPAREA_OFFSET_TOP+$(".scroll-inner").position().top;$(".PopUpChipBoxBorder").css("top",nTop);offset=13}else{nRowNo+=1;nTop=$(".Row"+nRowNo).position().top+5+18+C_CHIPAREA_OFFSET_TOP+$(".scroll-inner").position().top;$(".PopUpChipBoxBorder").css("top",
nTop);$(".TriangleBorderDown").addClass("TriangleBorderUp").removeClass("TriangleBorderDown");strTriangleBorder="TriangleBorderUp";offset=3}var nChipCenter=$("#"+strChipId).position().left+C_CHIPAREA_OFFSET_LEFT+$("#"+strChipId).width()/2;var nTriangleBorderLeft=nChipCenter-offset-(nChipCenter-nWidth/2);nLeft=nChipCenter-nWidth/2;if(nLeft-C_CHIPAREA_OFFSET_LEFT<1){nTriangleBorderLeft-=1+C_CHIPAREA_OFFSET_LEFT-nLeft;nLeft=1+C_CHIPAREA_OFFSET_LEFT}else if(nLeft+nWidth>=$(".ChipArea").width()){var nNewLeft=
$(".ChipArea").width()-nWidth-1;nTriangleBorderLeft+=nLeft-nNewLeft;nLeft=nNewLeft}nLeft+=20+$(".scroll-inner").position().left;$(".PopUpChipBoxBorder").css("left",nLeft);$("."+strTriangleBorder).css("left",nTriangleBorderLeft);for(var nLoop=0;nLoop<arrDuplChipId.length;nLoop++){var objPopUpChip=new ReserveChip("POPUP"+arrDuplChipId[nLoop][0]);gArrObjChip[arrDuplChipId[nLoop][0]].copy(objPopUpChip);objPopUpChip.stallUseId="POPUP"+arrDuplChipId[nLoop][0];objPopUpChip.createChip(C_CHIPTYPE_POPUP);if(gSelectedChipId){var strSvcInId=
"";if(gArrObjChip[gSelectedChipId])strSvcInId=gArrObjChip[gSelectedChipId].svcInId;else if(gArrObjSubChip[gSelectedChipId])strSvcInId=gArrObjSubChip[gSelectedChipId].svcInId;else if(gSelectedChipId==C_OTHERDTCHIPID)strSvcInId=gOtherDtChipObj.svcInId;if(strSvcInId!=objPopUpChip.svcInId)$("#"+objPopUpChip.stallUseId+" .Front").addClass("BlackBack")}BindPopUpChipTapEvent(objPopUpChip.stallUseId)}for(var nLoop=0;nLoop<arrDuplChipId.length;nLoop++){var strPopUpChipId="POPUP"+arrDuplChipId[nLoop][0];$("#"+
strPopUpChipId).css("width",(C_CELL_WIDTH-1)*2);$("#"+strPopUpChipId).css("left",(nLoop+1)*10+nLoop*(C_CELL_WIDTH*2-1));$("#"+strPopUpChipId).css("top",10);AdjustChipItemByWidth(strPopUpChipId)}if(arrDuplChipId.length>C_POPUP_MAX_CHIP_NUM){BindPopBoxClickEvent();$(".PopUpScrollBox").SmbMainFlickable();$(".ui-flickable-wrapper").css("background-color","")}}
function BindPopBoxClickEvent(){$(".PopUpChipInnerBox").bind(C_TOUCH_START,function(e){gStopFingerScrollFlg=true;$(".ChipArea_trimming").SmbFingerScroll({action:"stop"})})}
function setChipDisplayTimeAndStallIdToServer(strChipId,nRestFlg,nTapTime,nWorkTime){var jsonData="";if(nRestFlg!=null)if(IsCopyedChip(strChipId))jsonData={Method:"CreateRelationChip",ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,JobDtlId:gArrObjChip[strChipId].jobDtlId,StallId:gArrObjChip[strChipId].stallId,DisplayStartDate:nTapTime,ScheWorkTime:(gArrObjChip[strChipId].displayEndDate.getTime()-gArrObjChip[strChipId].displayStartDate.getTime())/
60/1E3,RestFlg:nRestFlg,InspectionNeedFlg:gArrObjChip[strChipId].inspectionNeedFlg,RowLockVersion:gArrObjChip[strChipId].rowLockVersion,PickDeliType:gArrObjChip[strChipId].pickDeliType,ScheSvcinDateTime:gArrObjChip[strChipId].scheSvcInDateTime,ScheDeliDateTime:gArrObjChip[strChipId].scheDeliDateTime};else jsonData={Method:"DisplayTimeAndStallId",ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,StallId:gArrObjChip[strChipId].stallId,
DisplayStartDate:nTapTime,ScheWorkTime:nWorkTime,RestFlg:nRestFlg,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};else if(IsCopyedChip(strChipId))jsonData={Method:"CreateRelationChip",ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,JobDtlId:gArrObjChip[strChipId].jobDtlId,StallId:gArrObjChip[strChipId].stallId,DisplayStartDate:nTapTime,ScheWorkTime:(gArrObjChip[strChipId].displayEndDate.getTime()-gArrObjChip[strChipId].displayStartDate.getTime())/
60/1E3,InspectionNeedFlg:gArrObjChip[strChipId].inspectionNeedFlg,RowLockVersion:gArrObjChip[strChipId].rowLockVersion,PickDeliType:gArrObjChip[strChipId].pickDeliType,ScheSvcinDateTime:gArrObjChip[strChipId].scheSvcInDateTime,ScheDeliDateTime:gArrObjChip[strChipId].scheDeliDateTime};else jsonData={Method:"DisplayTimeAndStallId",ShowDate:$("#hidShowDate").val(),SvcInId:gArrObjChip[strChipId].svcInId,StallUseId:gArrObjChip[strChipId].stallUseId,StallId:gArrObjChip[strChipId].stallId,DisplayStartDate:nTapTime,
ScheWorkTime:nWorkTime,RowLockVersion:gArrObjChip[strChipId].rowLockVersion};if(IsCopyedChip(strChipId))AddRowLockVersionOneBySvcInId(gArrObjChip[strChipId].svcInId);else AddRowLockVersionOne(strChipId);if($("#hidRestAutoJudgeFlg").val()=="1")if(!IsCopyedChip(strChipId)){var nOverDaysType=GetChipOverDaysType(strChipId);if(C_OVERDAYS_NONE<nOverDaysType)$("#"+gSelectedChipId).data(C_DATA_CHIPTAP_FLG,false)}DoCallBack(C_CALLBACK_WND101,jsonData,SC3240101AfterCallBack,jsonData.Method)}
function IsCopyedChip(strChipId){var nChipId=parseInt(strChipId);if(nChipId<=C_ARR_COPYEDCHIPID[0]&&nChipId>=C_ARR_COPYEDCHIPID[9])return true;else return false}
function AddRowLockVersionOne(strStallUseId){var strNewRowLockVersion=gArrObjChip[strStallUseId].rowLockVersion+1;var arrRelationChipId=FindRelationChips(strStallUseId,"");if(arrRelationChipId.length==0)gArrObjChip[strStallUseId].setRowLockVersion(strNewRowLockVersion);else for(var nLoop=0;nLoop<arrRelationChipId.length;nLoop++){var strRelationChipId=arrRelationChipId[nLoop][0];if(gArrObjChip[strRelationChipId])gArrObjChip[strRelationChipId].setRowLockVersion(strNewRowLockVersion)}}
function AddRowLockVersionOneBySvcInId(strSvcinId){var arrRelationChipId=FindRelationChips("",strSvcinId);if(arrRelationChipId.length==0){var arrChipId=FindChipsBySvcinId(strSvcinId);if(arrChipId.length>0)gArrObjChip[arrChipId[0]].setRowLockVersion(gArrObjChip[arrChipId[0]].rowLockVersion+1)}else for(var nLoop=0;nLoop<arrRelationChipId.length;nLoop++){var strRelationChipId=arrRelationChipId[nLoop][0];if(gArrObjChip[strRelationChipId])gArrObjChip[strRelationChipId].setRowLockVersion(gArrObjChip[strRelationChipId].rowLockVersion+
1)}}function GetPLanLaterTime(isFirst){var arrSvcinId=new Array;for(var strId in gArrObjChip){if(CheckgArrObjChip(strId)==false)continue;arrSvcinId.push(gArrObjChip[strId].svcInId)}arrSvcinId.sort();var methodName="GetPLanLaterTime";if(isFirst)methodName="GetPLanLaterTimeForFirstDisplay";jsonData={Method:methodName,SvcInIdLst:arrSvcinId.toString()};gCallbackSC3240101.doCallback(jsonData,SC3240101AfterCallBack)}
function getUpdateTime(){var dtPreRefreshDatetime=GetServerTimeNow();return DateFormat(dtPreRefreshDatetime,gDateFormatYYYYMMddHHmm)}
function SC3240101AfterCallBack(result){var rtList=$.parseJSON(result);if(rtList.Method!="ShowMainArea"&&rtList.Method!="ReShowMainAreaFromTheTime")ClearMainWndTimer();if(rtList.Method=="HasBeforeStartJob"){gMainAreaActiveIndicator.hide();var nRestFlg=C_RESTTIMEGETFLG_NOGETREST;if(rtList.ResultCode==1)ShowStallStopDialog(false);else ShowStallStopDialog(true);AfterCallBack();return}if(rtList.Method=="GetCanRestChange"){var canRestChange;if(rtList.ResultCode==1)canRestChange=true;else canRestChange=
false;AfterCallBack();CreateFooterButton(C_FT_DISPTP_SELECTED,GetChipType(gSelectedChipId),gArrObjChip[gSelectedChipId].tlmContractFlg,canRestChange);return}if(rtList.ResultCode==C_NO_ERROR||rtList.MessageId==C_CALLBACK_JUST_ALERT)switch(rtList.Method){case "ShowMainArea":$("#hidJsonData").val(htmlDecode(rtList.ChipInfo));setTimeout(function(){ResetRelationChipInfo(htmlDecode(rtList.RelationChipInfo));ShowMainArea(rtList.Method);SetWorkingChipHis(htmlDecode(rtList.WorkingChipHisInfo));setTimeout(function(){GetPLanLaterTime(true);
setTimeout(function(){SubChipSearch()},0)},0)},0);UpdateStallArea(htmlDecode(rtList.TechnicianInfo));ShowIdleArea(htmlDecode(rtList.StallIdleInfo));ShowKariKariChip(htmlDecode(rtList.KariKariChipInfo));$("#MessageUpdateTime").text(getUpdateTime());if(rtList.MessageId==C_CALLBACK_JUST_ALERT)alert(rtList.Message);break;case "ReShowMainArea":var strSubChipId="";if(gArrObjSubChip[gSelectedChipId]&&(gArrObjSubChip[gSelectedChipId].subChipAreaId==C_RECEPTION||gArrObjSubChip[gSelectedChipId].subChipAreaId==
C_NOSHOW||gArrObjSubChip[gSelectedChipId].subChipAreaId==C_STOP))strSubChipId=gSelectedChipId;RemoveAllStallChips();gSelectedChipId=strSubChipId;SetStallDate();$("#hidJsonData").val(htmlDecode(rtList.ChipInfo));setTimeout(function(){ResetRelationChipInfo(htmlDecode(rtList.RelationChipInfo));ShowMainArea();SetWorkingChipHis(htmlDecode(rtList.WorkingChipHisInfo));if(gSearchedChipId)if(gArrObjChip[gSearchedChipId]){ScrollToShowChip(gSearchedChipId);TapStallChip(gSearchedChipId);gSearchedChipId=""}setTimeout(function(){GetPLanLaterTime()},
0)},0);UpdateStallArea(htmlDecode(rtList.TechnicianInfo));ShowIdleArea(htmlDecode(rtList.StallIdleInfo));ShowKariKariChip(htmlDecode(rtList.KariKariChipInfo));$("#MessageUpdateTime").text(getUpdateTime());if(rtList.MessageId==C_CALLBACK_JUST_ALERT)alert(rtList.Message);break;case "ReShowMainAreaFromTheTime":SetStallDate();$("#hidJsonData").val(htmlDecode(rtList.ChipInfo));setTimeout(function(){RefreshMainArea(htmlDecode(rtList.ChipInfo));SetRelationChipInfo(htmlDecode(rtList.RelationChipInfo));SetWorkingChipHis(htmlDecode(rtList.WorkingChipHisInfo));
if(gSearchedChipId)if(gArrObjChip[gSearchedChipId]){ScrollToShowChip(gSearchedChipId);TapStallChip(gSearchedChipId);gSearchedChipId=""}setTimeout(function(){GetPLanLaterTime()},0)},0);UpdateStallArea(htmlDecode(rtList.TechnicianInfo));ShowIdleArea(htmlDecode(rtList.StallIdleInfo));ShowKariKariChip(htmlDecode(rtList.KariKariChipInfo));$("#MessageUpdateTime").text(getUpdateTime());if(rtList.MessageId==C_CALLBACK_JUST_ALERT)alert(rtList.Message);break;case "GetPLanLaterTime":var strJsonData=htmlDecode(rtList.Contents);
RefreshPlanDeliTime(strJsonData);setTimeout(function(){AllButtonRefresh();AfterCallBack()},0);break;case "GetPLanLaterTimeForFirstDisplay":var strJsonData=htmlDecode(rtList.Contents);RefreshPlanDeliTime(strJsonData);break;case "ClickBtnStopJob":var jsonData=htmlDecode(rtList.Contents);ShowLatestChips(jsonData,false,false);var strStallIdleId=htmlDecode(rtList.NewStallIdleId);if(strStallIdleId!="0"&&strStallIdleId!=""){if($("#"+C_UNAVALIABLENEWCHIPID).length==1){$("#"+C_UNAVALIABLENEWCHIPID).remove();
UpdateIdleArea(htmlDecode(rtList.StallIdleInfo))}BindUnavailableAreaEvent(C_UNAVALIABLECHIPID+strStallIdleId)}StopButtonRefresh();if(rtList.MessageId==C_CALLBACK_JUST_ALERT)alert(rtList.Message);AfterCallBack();break;case "GetTechnicians":case "SetStallTechnicians":var strTechnicianInfo=htmlDecode(rtList.TechnicianInfo);UpdateStallArea(strTechnicianInfo);SetTechnicianWndData(strTechnicianInfo);AfterCallBack();break;case "ClickBtnNoshow":var strJsonData=htmlDecode(rtList.Contents);ShowLatestChips(strJsonData,
false,false);NoShowButtonRefresh();if(rtList.MessageId==C_CALLBACK_JUST_ALERT)alert(rtList.Message);AfterCallBack();break;case "CreateRelationChip":var strJsonData=htmlDecode(rtList.Contents);ShowCreatedRelationChips(strJsonData);AddRelationChipInfo(htmlDecode(rtList.RelationChipInfo));if(rtList.MessageId==C_CALLBACK_JUST_ALERT)alert(rtList.Message);AfterCallBack();break;case "ClickBtnDeleteStallChip":var strJsonData=htmlDecode(rtList.Contents);ShowLatestChips(strJsonData,false,false);AllButtonRefresh();
if(rtList.MessageId==C_CALLBACK_JUST_ALERT)alert(rtList.Message);AfterCallBack();break;case "ClickBtnFinish":var strJsonData=htmlDecode(rtList.Contents);ShowLatestChips(strJsonData,false,false);CompletionInspecButtonRefresh();CarWashButtonRefresh();StopButtonRefresh();if(rtList.MessageId==C_CALLBACK_JUST_ALERT)alert(rtList.Message);AfterCallBack();break;case "UpdateStallUnavailable":UpdateIdleArea(htmlDecode(rtList.StallIdleInfo));AfterCallBack();break;case "ClickBtnStart":var backupJsonId=rtList.StallUseId;
if(C_CALLBACK_CONFIRM==rtList.MessageId){var result=confirm(htmlDecode(rtList.Message));if(result)gBackupStartJson[backupJsonId].ReStartJobFlg=C_RESTARTJOB_YES;else{gBackupStartJson[backupJsonId].ReStartJobFlg=C_RESTARTJOB_NO;$("#"+backupJsonId).addClass("StoppingJobColor")}DoCallBack(C_CALLBACK_WND101,gBackupStartJson[backupJsonId],SC3240101AfterCallBack,gBackupStartJson[backupJsonId].Method);AfterCallBack();gBackupStartJson[backupJsonId]=null;return}gBackupStartJson[backupJsonId]=null;var strJsonData=
htmlDecode(rtList.Contents);ShowLatestChips(strJsonData,false,false);SetWorkingChipHis(htmlDecode(rtList.WorkingChipHisInfo));if($("#"+rtList.StallUseId).length>0){if($("#"+rtList.StallUseId).data(C_DATA_CHIPTAP_FLG)==false)$("#"+rtList.StallUseId).data(C_DATA_CHIPTAP_FLG,true);if($("#WB"+rtList.StallUseId).length>0)$("#WB"+rtList.StallUseId).remove()}if(rtList.MessageId==C_CALLBACK_JUST_ALERT)alert(rtList.Message);AfterCallBack();break;case "DisplayTimeAndStallId":case "ClickBtnNoRest":case "ClickBtnRest":var strJsonData=
htmlDecode(rtList.Contents);ShowLatestChips(strJsonData,false,false);SetRelationChipInfo(htmlDecode(rtList.RelationChipInfo));if($("#"+rtList.StallUseId).length>0){if($("#"+rtList.StallUseId).data(C_DATA_CHIPTAP_FLG)==false)$("#"+rtList.StallUseId).data(C_DATA_CHIPTAP_FLG,true);if($("#WB"+rtList.StallUseId).length>0)$("#WB"+rtList.StallUseId).remove()}if(rtList.MessageId==C_CALLBACK_JUST_ALERT)alert(rtList.Message);AfterCallBack();break;case "UndoMainStallChip":var strJsonData=htmlDecode(rtList.Contents);
ShowLatestChips(strJsonData,false,false);if(rtList.RelationChipInfo!=null)AddRelationChipInfo(htmlDecode(rtList.RelationChipInfo));if($("#"+rtList.StallUseId).length>0){if($("#"+rtList.StallUseId).data(C_DATA_CHIPTAP_FLG)==false)$("#"+rtList.StallUseId).data(C_DATA_CHIPTAP_FLG,true);if($("#WB"+rtList.StallUseId).length>0)$("#WB"+rtList.StallUseId).remove()}if(rtList.MessageId==C_CALLBACK_JUST_ALERT)alert(rtList.Message);AfterCallBack();break;case "ClickBtnToReception":var strJsonData=htmlDecode(rtList.Contents);
ShowLatestChips(strJsonData,false,false);ReceptionButtonRefresh();if(rtList.MessageId==C_CALLBACK_JUST_ALERT)alert(rtList.Message);AfterCallBack();break;default:var strJsonData=htmlDecode(rtList.Contents);ShowLatestChips(strJsonData,false,false);if(rtList.RelationChipInfo!=null)AddRelationChipInfo(htmlDecode(rtList.RelationChipInfo));if(rtList.MessageId==C_CALLBACK_JUST_ALERT)alert(rtList.Message);AfterCallBack();break}else{alert(rtList.Message);SetTableUnSelectedStatus();SetChipUnSelectedStatus();
ClearAllMainWndTimer();ShowLatestChips(htmlDecode(rtList.Contents),false,true);SetWorkingChipHis(htmlDecode(rtList.WorkingChipHisInfo));if(rtList.RelationChipInfo!=null)AddRelationChipInfo(htmlDecode(rtList.RelationChipInfo));ClickChangeDate(0)}gArrBackChipObj.length=0}
function ShowKariKariChip(strKariKariChipJson){var chipDataList=$.parseJSON(strKariKariChipJson);for(var keyString in chipDataList){var chipData=chipDataList[keyString];var strKey=C_KARIKARICHIPID+chipData.SVCIN_TEMP_RESV_ID;var objKariChip=new ReserveChip(strKey);objKariChip.setKariKariChipParameter(chipData);if(objKariChip.displayStartDate-gStartWorkTime<0)objKariChip.setDisplayStartDate(gStartWorkTime);if(objKariChip.displayEndDate-gEndWorkTime>0)objKariChip.setDisplayEndDate(gEndWorkTime);objKariChip.createChip(C_CHIPTYPE_STALL_KARIKARI);
SetChipPosition(strKey,objKariChip.stallId,objKariChip.displayStartDate,objKariChip.displayEndDate)}}function SetWorkingChipHis(strChipHisJson){var chipDataList=$.parseJSON(strChipHisJson);for(var keyString in chipDataList){var chipHisData=chipDataList[keyString];var strKey=chipHisData.STALL_USE_ID;if(gArrObjChip[strKey])gArrObjChip[strKey].SetWorkingChipHis(chipHisData)}}
function ResetRelationChipInfo(strRelationChipJson){gArrObjRelationChip=new Array;var chipDataList=$.parseJSON(strRelationChipJson);for(var keyString in chipDataList){var chipData=chipDataList[keyString];var strKey=chipData.STALL_USE_ID;if(gArrObjRelationChip[strKey]==undefined)gArrObjRelationChip[strKey]=new RelationChip(strKey);gArrObjRelationChip[strKey].setChipParameter(chipData)}}
function AddRelationChipInfo(strRelationChipJson){var chipDataList=$.parseJSON(strRelationChipJson);if(!gArrObjRelationChip)gArrObjRelationChip=new Array;for(var keyString in chipDataList){var chipData=chipDataList[keyString];var strKey=chipData.STALL_USE_ID;if(!gArrObjRelationChip[strKey])gArrObjRelationChip[strKey]=new RelationChip(strKey);gArrObjRelationChip[strKey].setChipParameter(chipData)}}
function SetRelationChipInfo(strRelationChipJson){var chipDataList=$.parseJSON(strRelationChipJson);if(!gArrObjRelationChip)gArrObjRelationChip=new Array;for(var keyString in chipDataList){var chipData=chipDataList[keyString];var strKey=chipData.STALL_USE_ID;gArrObjRelationChip[strKey]=new RelationChip(strKey);gArrObjRelationChip[strKey].setChipParameter(chipData)}}
function BackChipRollBack(){for(var nLoop=0;nLoop<gArrBackChipObj.length;nLoop++)RollBackOneChip(gArrBackChipObj[nLoop]);ReshowAllWhiteBoards();SetLaterStallColorRed()}
function ReshowAllWhiteBoards(){$(".WhiteBorder").remove();var arrDuplicateChipsId=new Array;for(var strId in gArrObjChip){if(CheckgArrObjChip(strId)==false)continue;if(IsDefaultDate(gArrObjChip[strId].rsltStartDateTime)==false&&IsDefaultDate(gArrObjChip[strId].rsltEndDateTime)==true||IsDefaultDate(gArrObjChip[strId].rsltEndDateTime)==false)arrDuplicateChipsId.push(strId)}for(var strChipId in arrDuplicateChipsId){if(CheckgArrObjChip(arrDuplicateChipsId[strChipId])==false)continue;CreateWhiteBorders(arrDuplicateChipsId[strChipId])}}
function RollBackOneChip(objBackChip){if(objBackChip){var strChipId=objBackChip.stallUseId;if(gArrObjChip[strChipId]==null){gArrObjChip[strChipId]=new ReserveChip(strChipId);objBackChip.copy(gArrObjChip[strChipId]);gArrObjChip[strChipId].createChip(C_CHIPTYPE_STALL);BindChipClickEvent(strChipId)}else objBackChip.copy(gArrObjChip[strChipId]);gArrObjChip[strChipId].updateStallChip();SetChipPosition(strChipId,"","","")}}
function BackupRelationChips(strChipId){var objBackChip;gArrBackChipObj.length=0;var arrRelationChipId=FindRelationChips(strChipId,"");if(arrRelationChipId.length>0)for(var nLoop=0;nLoop<arrRelationChipId.length;nLoop++){var strRelationChipId=arrRelationChipId[nLoop][0];if(gArrObjChip[strRelationChipId]){objBackChip=new ReserveChip(strRelationChipId);gArrObjChip[strRelationChipId].copy(objBackChip);gArrBackChipObj.push(objBackChip)}}else{objBackChip=new ReserveChip(strChipId);gArrObjChip[strChipId].copy(objBackChip);
gArrBackChipObj.push(objBackChip)}}function ReDisplay(){__doPostBack("","");return false}function CheckChipPos(strChipId){var arrDuplChipId;if(strChipId==C_MOVINGCHIPID){arrDuplChipId=GetMovingCpDuplicateChips();if(arrDuplChipId.length>0)return false}else if(strChipId==C_MOVINGUNAVALIABLECHIPID){arrDuplChipId=GetUnavaliableMovingCpDuplicateChips();if(arrDuplChipId.length>0)return false}else{arrDuplChipId=GetDuplicateChips(strChipId);if(arrDuplChipId.length>1)return false}return true}
function IsDefaultDate(dtDate){var dtDefault=new Date(C_DATE_DEFAULT_VALUE);if(dtDate-dtDefault==0)return true;else return false}function DeleteWhiteBoarder(arrDuplChipId,strChipId){if(arrDuplChipId.length>0)for(var nLoop=0;nLoop<arrDuplChipId.length;nLoop++)$("#WB"+arrDuplChipId[nLoop][0]).remove();else $("#WB"+strChipId).remove()}
function GetPreRefreshDate(){var dtMaxUpdateDate=new Date;dtMaxUpdateDate.setHours(0);dtMaxUpdateDate.setMinutes(0);dtMaxUpdateDate.setSeconds(0);dtMaxUpdateDate.setMilliseconds(0);for(var nChipNo in gArrObjChip){if(CheckgArrObjChip(nChipNo)==false)continue;if(dtMaxUpdateDate-gArrObjChip[nChipNo].rowUpdateDateTime<0)dtMaxUpdateDate.setTime(gArrObjChip[nChipNo].rowUpdateDateTime.getTime())}dtMaxUpdateDate.setSeconds(0);dtMaxUpdateDate.setMilliseconds(0);var offsetMilliSecond=Number($("#MstPG_RefreshTimerTime").val());
dtMaxUpdateDate.setTime(dtMaxUpdateDate.getTime()-offsetMilliSecond);return dtMaxUpdateDate}
function IsDelayDelivery(chipObject){if(IsDefaultDate(chipObject.scheDeliDateTime))return false;var nowDateTime=GetServerTimeNow();nowDateTime.setSeconds(0);nowDateTime.setMilliseconds(0);if(chipObject.scheDeliDateTime<nowDateTime)return true;var dtDeliDelay=GetDeliDelayExpectedTimeLine(chipObject.carWashNeedFlg,chipObject.scheDeliDateTime,chipObject.svcStatus,chipObject.remainingInspectionType);if(dtDeliDelay<chipObject.displayEndDate)return true;return false}
function IsTodayStartDate(strChipId){if(strChipId==""||strChipId==null)return false;var strMovingChip;if(strChipId==C_NEWCHIPID)strMovingChip=C_NEWCHIPID;else strMovingChip=C_MOVINGCHIPID;if($("#"+strMovingChip+" .TimeKnobPointL").length==1)return true;if(gArrObjChip[strChipId])if(IsDefaultDate(gArrObjChip[strChipId].rsltStartDateTime))return false;else{var dtRsltStartDateTime=new Date(gArrObjChip[strChipId].rsltStartDateTime);var dtShowDate=new Date($("#hidShowDate").val());if(CompareDate(dtRsltStartDateTime,
dtShowDate)<0)return false;else return true}else return true};
