(function(window){var fn={constants:{startEvent:"mousedown touchstart",selectEvent:"select",drag:"mousemove touchmove",endEvent:"mouseup touchend",dumper:.02,scrollDeltaMod:4.7,scrollbarWidth:5,minScrollHeight:13,flickReleaseHeight:60,animateTimeNormal:800,animateTimeLong:1600},getTranslate:function(data){var attr=data.inner.get(0).style["transform"];var m=attr.match(/translate3d\((.+)px,\s*(.+)px,\s*(.+)px\)/);return{top:parseInt(m[2]),left:parseInt(m[1])}},setTranslate:function(data,position){data.inner.css({"transform":"translate3d("+
position.left+"px, "+"0px, 0px)"})},setScrollBarTranslate:function(data,position){data.scrollBar.css({"transform":"translate3d(0px, "+position.scrollTop+"px, 0px)","opacity":1})},stopAnimate:function(data){var matrix=new WebKitCSSMatrix(window.getComputedStyle(data.inner.get(0)).webkitTransform);var matrixBar=new WebKitCSSMatrix(window.getComputedStyle(data.scrollBar.get(0)).webkitTransform);fn.setTranslate(data,{top:parseInt(matrix.f),left:parseInt(matrix.e)});fn.setScrollBarTranslate(data,
{scrollTop:parseInt(matrix.f)});data.inner.css({"-webkit-transition":"none"});data.scrollBar.css({"-webkit-transition":"none"})},init:function(param){var $target=$(this).css({"position":"relative","overflow":"hidden","-webkit-tap-highlight-color":"rgba(0,0,0,0)"});if($target.find(".scroll-inner-SC3240201").length==0)$target.wrapInner('<div class="scroll-inner-SC3240201" style="transform:translate3d(0px,0px,0px);left:0px;top:0px;position:relative;" />');var $inner=$target.find(".scroll-inner-SC3240201");
var data={};data.target=$target;data.inner=$inner;data.popover=param!==undefined&&param.popover===true;fn.createScrollBar(data);if(param!==undefined&&param.action!==undefined&&param.action)if(param.action=="stop"){if(data.target.hasClass("fingerscroll-stop")===false)data.target.addClass("fingerscroll-stop")}else if(param.action=="move"){fn.stopAnimate(data);var pos=fn.getTranslate(data);var moveValue={top:pos.top,left:pos.left};if(param.moveY!==undefined)moveValue.top+=parseInt(param.moveY)*-1;if(param.moveX!==
undefined)moveValue.left+=parseInt(param.moveX)*-1;fn.setTranslate(data,moveValue)}else{if(param.action=="restart"){fn.stopAnimate(data);data.target.removeClass("fingerscroll-stop")}}else{data.target.removeClass("fingerscroll-stop");$inner.css({"transform":"translate3d(0px, 0px, 0px)"})}var inputs=$inner.find("input");data.inputs=[];data.manualFocus=false;data.topLimit=$target.offset().top+$target.height()/2;data.bottomLimit=$target.offset().top+$target.height();for(i=0;i<inputs.size();i++){var $a=
$(inputs[i]);var ah=$a.offset().top;for(j=0;j<data.inputs.length;j++){var $b=data.inputs[j];var bh=$b.offset().top;if(ah<bh){data.inputs.splice(j,0,$a);$a=null;break}}if($a)data.inputs.push($a)}for(i=0;i<data.inputs.length;i++)data.inputs[i].data("pos",i).bind("touchstart mousedown",data,function(e){e.data.manualFocus=true}).bind("focusin",data,function(e){var self=$(this),prevInput=e.data.target.data("prevInput"),prevIndex=prevInput?prevInput.data("pos"):-1,currIndex=self.data("pos"),deltaY=0;if(prevInput&&
prevInput.get(0)==self.get(0))return;e.data.target.data("prevInput",self);if(e.data.manualFocus)e.data.manualFocus=false;else{if(prevIndex==-1);else if(prevIndex<currIndex){if(e.data.bottomLimit<self.offset().top)deltaY=self.offset().top-prevInput.offset().top}else if(currIndex<prevIndex)if(self.offset().top<e.data.topLimit)if(-10<fn.getTranslate(e.data).top)deltaY=0;else deltaY=self.offset().top-prevInput.offset().top;e.data.target.fingerScroll({action:"move",moveY:deltaY})}});$inner.unbind("refreshScrollBar",
fn.refreshScrollBar).bind("refreshScrollBar",data,fn.refreshScrollBar);$target.unbind(fn.constants.startEvent,fn.start).bind(fn.constants.startEvent,data,fn.start)},refreshScrollBar:function(e){fn.setSize(e.data);if(fn.resizeScrollBar(e.data)){fn.setScrollBarTranslate(e.data,fn.calcScroll(e.data,{top:0,left:0},"refreshScrollBar"));e.data.scrollBar.show(0);if(e.data.refreshScrollBarTimer)clearTimeout(e.data.refreshScrollBarTimer);e.data.refreshScrollBarTimer=setTimeout(function(){e.data.scrollBar.fadeOut(150)},
2E3)}},setSize:function(data){data.innerSize={width:data.inner.outerWidth({margin:true})-data.target.innerWidth(),height:data.inner.outerHeight({margin:true})-data.target.innerHeight()};data.dataHeight=data.inner.outerHeight(true);data.scrollHeight=data.target.innerHeight()},select:function(e){event.preventDefault();return false},start:function(e){fn.stopAnimate(e.data);$(document).unbind(fn.constants.drag,fn.drag);$(document).unbind(fn.constants.endEvent,fn.stop);if(!event.changedTouches===undefined&&
event.changedTouches.length>1)return;if(e.data.target.hasClass("fingerscroll-stop")===true)return;fn.setSize(e.data);if(e.data.innerSize.width<=0&&e.data.innerSize.height<=0){if(e.type==="mousedown")event.preventDefault();return}$(document).bind(fn.constants.drag,e.data,fn.drag).bind(fn.constants.endEvent,e.data,fn.stop);e.data.capture={};e.data.position=fn.getEventPosition();e.data.startPosition=fn.getEventPosition();if(fn.resizeScrollBar(e.data))fn.setScrollBarTranslate(e.data,fn.calcScroll(e.data,
{top:0,left:0},"start"));if(e.data.refreshScrollBarTimer)clearTimeout(e.data.refreshScrollBarTimer);e.data.captures=[{x:e.data.position.x,y:e.data.position.y,time:new Date}];e.data.isFlickReleaseTop=e.data.isFlickReleaseBottom=false;var curTranslate=fn.getTranslate(e.data);if(Math.abs(curTranslate.top)<=5)e.data.isFlickReleaseTop=true;else if(e.data.target.height()+Math.abs(curTranslate.top)+5>=e.data.inner.height())e.data.isFlickReleaseBottom=true},drag:function(e){if(e.data.target.hasClass("fingerscroll-stop")===
true){fn.stop(e);if(event)event.preventDefault();return}var evtPos=fn.getEventPosition();var y=evtPos.y,x=evtPos.x;var move={top:y-e.data.position.y,left:x-e.data.position.x};var src=fn.calcScroll(e.data,move,"drag");fn.setTranslate(e.data,src);fn.setScrollBarTranslate(e.data,src);e.data.scrollBar.show(0);e.data.position.y=y;e.data.position.x=x;if(e.data.captures.length>4)e.data.captures.shift();e.data.captures.push({x:e.data.position.x,y:e.data.position.y,time:new Date});if(e.data.popover)return false},
stop:function(e){$(document).unbind(fn.constants.drag,fn.drag).unbind(fn.constants.endEvent,fn.stop);var evtPos=fn.getEventPosition();var y=evtPos.y,x=evtPos.x;var now=new Date,lastDragTime=e.data.captures[e.data.captures.length-1].time;if(now.getTime()-lastDragTime.getTime()>=210)e.data.captures.push({x:e.data.position.x,y:e.data.position.y,time:new Date});var x1,x2,y1,y2;x1=x2=e.data.captures[e.data.captures.length-1].x,y1=y2=e.data.captures[e.data.captures.length-1].y;var lastTime=e.data.captures[e.data.captures.length-
1].time.getTime();for(var i=e.data.captures.length-2;i>=0;i--)if(lastTime-e.data.captures[i].time.getTime()<=30||i==e.data.captures.length-2){x1=e.data.captures[i].x;y1=e.data.captures[i].y}var timingFunction="cubic-bezier(0.0, 1, 0.5, 1)";var src,eventName="",aniTime=fn.constants.animateTimeNormal;var top=0,left=0;if(Math.abs(y2-y1)>7||Math.abs(x2-x1)>7){top=fn.constants.scrollDeltaMod*(y2-y1);left=fn.constants.scrollDeltaMod*(x2-x1);src=fn.calcScroll(e.data,{top:top,left:left},"stop");if(fn.constants.scrollDeltaMod*
Math.abs(x2-x1)>1E3)aniTime=fn.constants.animateTimeLong}else{src=fn.calcScroll(e.data,{top:top,left:left},"stop");aniTime=fn.constants.animateTimeNormal}var startEvent="",endEvnet="";if(e.data.isFlickReleaseTop===true){if(src.overTopSize>=fn.constants.flickReleaseHeight){startEvent="startFlickReleaseTop";endEvnet="endFlickReleaseTop"}}else if(e.data.isFlickReleaseBottom===true)if(src.overBottomSize>=fn.constants.flickReleaseHeight){startEvent="startFlickReleaseBottom";endEvnet="endFlickReleaseBottom"}if(startEvent!==
"")e.data.target.triggerHandler(startEvent);if(Math.abs(top)>0||Math.abs(left)>0||src.overTopSize>0||src.overBottomSize>0){e.data.inner.css({"-webkit-transition":aniTime+"ms "+timingFunction,"transform":"translate3d("+src.left+"px, "+src.top+"px, 0px)"}).one("webkitTransitionEnd",e.data,function(we){we.data.scrollBar.fadeOut(fn.constants.scrollDuration);we.data.inner.css({"-webkit-transition":"none"});if(endEvnet!=="")we.data.target.triggerHandler(endEvnet)});if(Math.abs(top)>0||Math.abs(left)>
0)e.data.scrollBar.css({"-webkit-transition":aniTime+"ms "+timingFunction,"transform":"translate3d(0px, "+src.scrollTop+"px, 0px)"}).one("webkitTransitionEnd",e.data,function(we){we.data.scrollBar.css({"-webkit-transition":"none"})})}else{fn.setTranslate(e.data,fn.calcScroll(e.data,{top:0,left:0},"stop"));e.data.scrollBar.fadeOut(0)}if(e.data.popover&&(e.data.startPosition.x!=x&&e.data.startPosition.y!=y))return false},calcScroll:function(data,move,action){var curTranslate=fn.getTranslate(data);
var top=curTranslate.top+move.top;if(action==="drag"){if(top>0){if(top>data.target.height()*.6)top=Math.ceil(data.target.height()*.6);top-=fn.constants.dumper*top}if(top<-data.innerSize.height){if(Math.abs(top+data.innerSize.height)>data.target.height()*.6)top=-(data.innerSize.height+Math.ceil(data.target.height()*.6));top-=fn.constants.dumper*(top+data.innerSize.height)}}else top=Math.max(Math.min(0,top),-data.innerSize.height);var left=curTranslate.left+move.left;if(action==="drag"){if(left>0)left-=
fn.constants.dumper*left;if(left<-data.innerSize.width)left-=fn.constants.dumper*(left+data.innerSize.width)}else left=Math.max(Math.min(0,left),-data.innerSize.width);if(data.innerSize.width<=0)left=0;var scrollY;if(top<0){var rate=Math.min((Math.abs(top)+data.scrollHeight)/data.dataHeight,1);scrollY=Math.max(0,Math.ceil(data.scrollHeight*rate)-data.scrollBar.outerHeight())-1}else scrollY=0;return{top:top,left:left,scrollTop:scrollY,overTopSize:curTranslate.top>0?curTranslate.top:0,overBottomSize:curTranslate.top<
-data.innerSize.height?Math.abs(curTranslate.top+data.innerSize.height):0}},getEventPosition:function(){if(event.changedTouches!==undefined&&event.changedTouches)return{x:event.changedTouches[0].clientX,y:event.changedTouches[0].clientY};else return{x:event.pageX,y:event.pageY}},createScrollBar:function(data){if($(".scroll-bar",data.target).length==0)data.target.append('<div class="scroll-bar" />');var $bar=$(".scroll-bar",data.target).css({"position":"absolute","border":"1px solid #777","border-radius":"5px",
"background":"rgba(100,100,100,0.8)","width":fn.constants.scrollbarWidth+"px","top":"0px","right":"0px","display":"none","transform":"translate3d(0px, 0px, 0px)","box-sizing":"border-box","visibility":"hidden"});data.scrollBar=$bar},resizeScrollBar:function(data){var scrollH=data.target.height(),dataH=data.inner.height(),scrollBarH;var rate=scrollH>dataH?1:scrollH/dataH;data.scrollBar.height(Math.max(Math.ceil(scrollH*rate),fn.constants.minScrollHeight));return rate!==1}};$.fn.SC3240201fingerScroll=
function(param){return this.each(function(){fn.init.call(this,param)})}})(window);
